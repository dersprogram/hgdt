

<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DERS-TAKİP</title>
  <style>
    :root{
      --orange:#ff7a00;
      --bg:#0b1220;
      --panel:rgba(255,255,255,0.06);
      --line:rgba(255,255,255,0.10);
      --text:#ffffff;
      --muted:rgba(255,255,255,0.70);
      --mutedText: rgba(255,255,255,0.55);
      --headerText: rgba(255,255,255,0.70);
      --timeText: rgba(255,255,255,0.60);
      --topbar1: rgba(6,10,16,0.72);
      --topbar2: rgba(6,10,16,0.30);
      --topbar3: rgba(6,10,16,0.00);

      --radius:22px;
      --frame:3px;   /* turuncu şerit kalınlığı */
      --inset:10px;  /* ekran kenarından boşluk */
      --innerPad:14px;
      --shadow: 0 10px 30px rgba(0,0,0,0.35);
    }


/* ===== Yazı Boyutu (3 Kademe) ===== */
:root{
  --uiScale: 1; /* 1=Orta */
}
body.text-small{ --uiScale: 0.90; }
body.text-medium{ --uiScale: 1; }
body.text-large{ --uiScale: 1.14; }
body.text-xlarge{ --uiScale: 1.26; }

/* Genel */
.app{ font-size: calc(14px * var(--uiScale)); }
.hint, .settingsHint, .notesItemMeta{ font-size: calc(12px * var(--uiScale)); }

/* Üst kısım */
.appTitle{ font-size: calc(24px * var(--uiScale)); }
.modeBtn{
  font-size: calc(13px * var(--uiScale));
  padding: calc(10px * var(--uiScale)) calc(16px * var(--uiScale));
}
.dayTab{
  font-size: calc(13px * var(--uiScale));
  padding: calc(10px * var(--uiScale)) calc(14px * var(--uiScale));
}

/* Tablo */
.tableHeader{ font-size: calc(13px * var(--uiScale)); }
.no{ font-size: calc(18px * var(--uiScale)); }
.time{ font-size: calc(13px * var(--uiScale)); opacity: .78; text-align:left; }
.class, .lesson{ font-size: calc(15px * var(--uiScale)); font-weight: 900; letter-spacing: .2px; }
.row{padding-left:4px;padding-right:6px; padding: calc(12px * var(--uiScale)) calc(12px * var(--uiScale)); }

/* Notlar / Modal */
.sheetTitle{ font-size: calc(16px * var(--uiScale)); }
.pill{ font-size: calc(12px * var(--uiScale)); }
.btn, .notesBtn, .settingsClose, .settingsSave{ font-size: calc(13px * var(--uiScale)); }
.btn, .notesBtn, .settingsClose, .settingsSave{
  padding: calc(10px * var(--uiScale)) calc(12px * var(--uiScale));
}
.label{ font-size: calc(12px * var(--uiScale)); }
input, textarea{ font-size: calc(14px * var(--uiScale)); }

/* Ayarlar */
.settingsTitle{ font-size: calc(16px * var(--uiScale)); }
.settingsChip{ font-size: calc(13px * var(--uiScale)); }
    

/* ===== Tema (Tüm Uygulama) ===== */
body.theme-day{
  --bg:#e5eaf2;
  --panel:#f4f7fb;
  --frame:#f0f4f9;
  --text:#0b1220;
  --muted: rgba(11,18,32,0.68);
  --line: rgba(11,18,32,0.14);
  --shadow: 0 10px 26px rgba(2,6,23,0.14);
  --mutedText: rgba(11,18,32,0.70);
  --headerText: rgba(11,18,32,0.72);
  --timeText: rgba(11,18,32,0.75);
  --topbar1: rgba(222,226,235,0.96);
  --topbar2: rgba(222,226,235,0.78);
  --topbar3: rgba(222,226,235,0.00);
}
/* Gece modu: :root değerleri geçerli */

html, body{
      height:100%;
      margin:0;
      background:#000;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      overscroll-behavior:none;
    }

    /* Uygulama ekranı */
    .app{
      position:relative;
      height:100vh;
      width:100vw;
      background:var(--bg);
      overflow:hidden; /* içerik şeridin altına girince kaybolsun */
    }

    /* Kaydırılan içerik alanı */
    .scrollArea{
      position:absolute;
      inset:var(--inset);
      padding: calc(var(--innerPad) + var(--frame));
      overflow:auto;
      -webkit-overflow-scrolling:touch;
      border-radius: var(--radius);
      clip-path: inset(0 round var(--radius));
    }

    /* Turuncu şerit: sabit çerçeve */
    .frame{
      position:fixed;
      left:var(--inset);
      top:var(--inset);
      right:var(--inset);
      bottom:var(--inset);
      border: var(--frame) solid var(--orange);
      border-radius: var(--radius);
      pointer-events:none;
      z-index:9999;
      box-sizing:border-box;
    }

    /* Üst alan */
    .topbar{
      position:sticky;
      top:0;
      z-index:50;
      padding: 6px 0 12px;
      background: linear-gradient(to bottom, rgba(11,18,32,0.96), rgba(11,18,32,0.70), rgba(11,18,32,0));
      backdrop-filter: blur(6px);
    }

    .appTitle{
      color:#fff;
      /* Başlıkta DERS her modda beyaz kalsın */
      font-weight:900;
      letter-spacing:2px;
      text-align:center;
      font-size:24px;
      margin: 6px 0 12px;
      user-select:none;
    }
    .accent{ color: var(--orange); }

    .modeToggle{
      display:flex;
      gap:10px;
      justify-content:center;
      margin: 0 0 12px;
    }
    .modeBtn{
      border:1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.06);
      color:var(--text);
      padding: 10px 16px;
      border-radius: 14px;
      font-weight: 900;
      letter-spacing: 1px;
      cursor:pointer;
    }
    .modeBtn.active{
      background: var(--orange);
      border-color: transparent;
      color:#10131a;
    }

    .dayTabs{
      display:flex;
      gap:10px;
      overflow-x:auto;
      padding: 2px 2px 6px;
      -webkit-overflow-scrolling: touch;
      scrollbar-width:none;
    }
    .dayTabs::-webkit-scrollbar{ display:none; }

    .dayTab{
      flex:0 0 auto;
      border:1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.05);
      color:var(--text);
      padding: 10px 14px;
      border-radius: 14px;
      font-weight: 900;
      opacity:0.85;
      cursor:pointer;
    }
    .dayTab.active{
      background: var(--orange);
      color:#10131a;
      border-color: transparent;
      opacity:1;
    }

    /* Swipe alanı */
    .daySwipe{
      overflow:hidden;
      border-radius: 16px;
      margin-top: 6px;
    }
    .dayTrack{
      display:flex;
      width:700%;
      transform: translateX(0%);
      transition: transform 220ms ease;
      will-change: transform;
    }
    .dayPage{
      width: calc(100% / 7);
      padding: 6px 0 16px;
      min-height: 260px;
    }

    /* Tablo kartı */
    .tableCard{
      background: var(--panel);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 16px;
      overflow:hidden;
    }
    .tableHeader{
      /* başlık hizaları */
      display:grid;
      grid-template-columns: 26px 42px 1fr 70px 1.4fr;
      padding: 12px 12px 10px;
      color: var(--headerText);
      font-weight: 900;
      letter-spacing: 1px;
      border-bottom: 1px solid var(--line);
      font-size: 13px;
      user-select:none;
    }

    /* Başlık hizaları (resimdeki gibi) */
    .tableHeader > div:nth-child(1){ text-align:center; } /* nokta sütunu boş */
    .tableHeader > div:nth-child(2){ text-align:center; } /* # */
    .tableHeader > div:nth-child(3){ text-align:left; }   /* SAAT */
    .tableHeader > div:nth-child(4){ text-align:center; } /* SINIF */
    .tableHeader > div:nth-child(5){ text-align:left; }   /* DERS */
    /* Başlıkları alanlarla birebir hizalamak için küçük kaydırma */

    .row{padding-left:4px;padding-right:6px;
      display:grid;
      /* dot + no + sınıf + ders + zaman */
      grid-template-columns: 26px 42px 70px 1.4fr 0.9fr;
      padding: 12px 12px;
      align-items:center;
      border-bottom: 1px solid var(--line);
      position: relative;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    .row:last-child{ border-bottom: none; }
    .row:active{ background: rgba(255,255,255,0.04); }

    .dotBtn{width:12px;height:12px;
      width: 18px;
      height: 18px;
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
    }
    .dot{width:6px;height:6px;
      width:10px;
      height:10px;
      border-radius:999px;
      background: transparent;
      box-shadow: none;
    }
    .dot.on{
      background: var(--orange);
      box-shadow: 0 0 0 3px rgba(255,122,0,0.16);
    }

    .no{
      color: var(--orange);
      font-weight: 1000;
      font-size: 18px;
      text-align:center;
    }
    .time{
      color: var(--timeText);
      font-weight: 800;
      letter-spacing: 0.5px;
      font-size: 15px;
      white-space: nowrap;
    }
    .class{
      color: var(--orange);
      font-weight: 1000;
      letter-spacing: 0.5px;
      text-align:center;
      white-space: nowrap;
    }
    .lesson{
      color: var(--text);
      font-weight: 1000;
      letter-spacing: 0.6px;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }

    /* Haftalık placeholder */
    .weeklyWrap{ display:none; margin-top: 10px; }
    .noteCard{
      margin-top: 12px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 16px;
      padding: 12px;
      color: rgba(255,255,255,0.85);
      font-weight: 700;
    }
    .muted{ color: var(--muted); font-weight: 700; }

    /* Modal (nokta tıkla / uzun bas) */
    .modalOverlay{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.55);
      display:none;
      align-items: flex-end;
      z-index: 9998; /* frame 9999 üstte, ama pointer-events none */
    }
    .modalOverlay.show{ display:flex; }

    .sheet{
      width: 100%;
      max-height: 88vh;
      background: rgba(13,20,36,0.96);
      border-top-left-radius: 22px;
      border-top-right-radius: 22px;
      border: 1px solid rgba(255,255,255,0.10);
      box-shadow: var(--shadow);
      padding: 14px 14px 18px;
      overflow:auto;
      -webkit-overflow-scrolling: touch;
    }
    .sheetHeader{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 10px;
    }
    .sheetTitle{
      color: var(--text);
      font-weight: 1000;
      letter-spacing: 1px;
      font-size: 16px;
      overflow:hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .pill{
      font-weight: 1000;
      color:#10131a;
      background: var(--orange);
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px;
      white-space: nowrap;
    }
    .btn{
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.06);
      color: var(--text);
      font-weight: 900;
      letter-spacing: 0.5px;
      border-radius: 14px;
      padding: 10px 12px;
      cursor:pointer;
    }
    .btnPrimary{
      background: var(--orange);
      border-color: transparent;
      color:#10131a;
    }
    .btnRow{
      display:flex;
      gap:10px;
      margin-top: 12px;
    }
    .field{
      margin-top: 10px;
    }
    .label{
      color: var(--headerText);
      font-weight: 900;
      letter-spacing: 0.5px;
      font-size: 12px;
      margin-bottom: 6px;
    }
    input, textarea{
      width: 100%;
      box-sizing: border-box;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.05);
      color: var(--text);
      padding: 12px;
      font-weight: 700;
      outline: none;
    }
    textarea{ min-height: 86px; resize: vertical; }

    .hr{
      height: 1px;
      background: rgba(255,255,255,0.10);
      margin: 12px 0;
    }

    .hint{
      color: var(--timeText);
      font-weight: 700;
      font-size: 12px;
      line-height: 1.35;
      margin-top: 10px;
    }

    button{ -webkit-tap-highlight-color: transparent; }
  
    /* NOTLAR butonu (günlük tablonun altında, sol altta) */
    .notesEntry{
      display:flex;
      justify-content:flex-start;
      margin-top: 14px;
    }
    .notesBtn{
      display:inline-flex;
      align-items:center;
      gap:8px;
      border:1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.05);
      color: var(--text);
      font-weight: 1000;
      letter-spacing: 1px;
      border-radius: 14px;
      padding: 10px 14px;
      cursor:pointer;
    }
    .notesDot{
      width:10px;
      height:10px;
      border-radius:999px;
      background: transparent;
    }
    #notesOverlay{ z-index: 10000; }
    
    #notesOverlay.show{ display:flex; }


    .notesDot.on{
      background: var(--orange);
      box-shadow: 0 0 0 3px rgba(255,122,0,0.16);
    }

    /* NOTLAR filtreleri */
    .filters{
      display:flex;
      gap:10px;
      overflow-x:auto;
      padding: 2px 2px 8px;
      -webkit-overflow-scrolling: touch;
      scrollbar-width:none;
    }
    .filters::-webkit-scrollbar{ display:none; }
    .filterBtn{
      flex:0 0 auto;
      border:1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.05);
      color: var(--text);
      font-weight: 1000;
      letter-spacing: 0.6px;
      border-radius: 999px;
      padding: 8px 12px;
      cursor:pointer;
      opacity: 0.9;
      white-space: nowrap;
    }
    .filterBtn.active{
      background: var(--orange);
      border-color: transparent;
      color:#10131a;
      opacity: 1;
    }

    .notesItemTitle{
      font-weight: 1000;
      letter-spacing: 0.4px;
      margin-bottom: 6px;
      color: var(--text);
    }
    .notesItemMeta{
      color: var(--headerText);
      font-weight: 800;
      font-size: 12px;
      line-height: 1.35;
    }

  
          .tableHeader > div:nth-child(5){ padding-left: 6px; }
    }

  
    /* Web'de de telefon görünümü gibi olsun */
    .scrollArea{
      max-width: 390px; /* webde TAM telefon hissi */
      width: 100%;
      margin: 0 auto;
    }

  
    @media (max-width: 480px){
      /* Telefonda başlık metinleri (SINIF/DERS) görsel olarak biraz sola kayabiliyor */
      .tableHeader{ letter-spacing: 0.6px; }
      .tableHeader > div{ justify-self: stretch; }
      .tableHeader > div:nth-child(4){
        justify-self: center;
        padding-left: 18px;
      }
      .tableHeader > div:nth-child(5){
        justify-self: start;
        padding-left: 20px;
      }
    }

  
    /* TELEFON GÖRÜNÜMÜ – eski dar tasarıma benzer */
    body{
      display:flex;
      justify-content:center;
    }
    .app{
      width:100%;
      max-width: 420px;
    }


    /* ===== HAFTALIK TABLO (GÜNLÜKTEN BAĞIMSIZ) ===== */
    #weeklyGridWrap{
      width:100%;
      overflow-x:auto;
      margin-top: 10px;
      border-radius: 16px;
      background: rgba(255,255,255,0.04);
      border: 1px solid rgba(255,255,255,0.08);
    }
    table.weekGrid{
      border-collapse: separate;
      border-spacing: 0;
      width: max-content;
      min-width: 100%;
      font-size: 12px;
      color: rgba(255,255,255,0.92);
    }
    .weekGrid th, .weekGrid td{
      padding: 8px 6px;
      border-bottom: 1px solid rgba(255,255,255,0.08);
      border-right: 1px solid rgba(255,255,255,0.06);
      background: rgba(0,0,0,0.05);
      vertical-align: top;
      text-align: left;
    }
    .weekGrid th{
      font-weight: 950;
      letter-spacing: 0.6px;
      color: rgba(255,255,255,0.78);
      background: rgba(255,255,255,0.04);
      text-align: center;
    }
    .weekGrid .stickyTop{ position: sticky; top: 0; z-index: 3; }
    .weekGrid .stickyLeft{ position: sticky; left: 0; z-index: 2; background: rgba(10,14,22,0.94); text-align:left; }
    .weekGrid .corner{ z-index: 4; background: rgba(10,14,22,0.98); }
    .weekGrid tr:last-child td{ border-bottom: none; }
    .weekGrid td:last-child, .weekGrid th:last-child{ border-right: none; }
    \.wCell{ min-width: 76px; max-width: 96px; }
    .wCls{ display:block; font-weight: 1000; color: var(--orange); margin-bottom: 3px; font-size: 11px; line-height: 1.1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .wLes{ display:-webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; font-weight: 950; color: rgba(255,255,255,0.95); font-size: 11px; line-height: 1.15; }


    .tNo{ font-weight:900; font-size:11px; margin-bottom:2px; }
    .tTime{ font-size:10px; opacity:.65; line-height:1.05; }
    .weekGrid th{ padding: 6px 4px; }


    /* ===== Responsive (Dikey / Yatay) ===== */
    @media (orientation: portrait){
      .weekGrid th, .weekGrid td{ font-size: 10px; }
      .wCls{ font-size: 10px; }
      .wLes{ font-size: 10px; }
      .tNo{ font-size: 10px; }
      .tTime{ font-size: 9px; }
    }
    @media (orientation: landscape){
      .weekGrid th, .weekGrid td{ font-size: 12px; }
      .wCls{ font-size: 12px; }
      .wLes{ font-size: 12px; }
      .tNo{ font-size: 12px; }
      .tTime{ font-size: 11px; }
    }


/* ===== Ayarlar Paneli (Overlay) ===== */
.settingsBtn{
  position: fixed;
  top: 12px;
  right: 12px;
  width: 44px;
  height: 44px;
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,0.12);
  background: rgba(255,255,255,0.06);
  color: rgba(255,255,255,0.92);
  font-size: 20px;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  z-index: 5000;
  -webkit-tap-highlight-color: transparent;
}
.settingsBtn:active{ transform: scale(.98); }

.settingsOverlay{
  position: fixed;
  inset: 0;
  display: none;
  z-index: 6000;
}
.settingsOverlay.open{ display:block; }

.settingsBackdrop{
  position:absolute;
  inset:0;
  background: rgba(0,0,0,0.55);
  cursor: pointer;
}

.settingsPanel{
  position:absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%,-50%);
  width: min(520px, calc(100vw - 22px));
  max-height: min(82vh, 760px);
  overflow: hidden;
  border-radius: 18px;
  border: 1px solid rgba(255,255,255,0.10);
  background: rgba(10,18,32,0.98);
  box-shadow: 0 18px 60px rgba(0,0,0,0.55);
  display:flex;
  flex-direction: column;
}

.settingsTop{
  padding: 12px 12px;
  display:flex;
  align-items:center;
  justify-content: space-between;
  gap: 12px;
  border-bottom: 1px solid rgba(255,255,255,0.08);
}
.settingsTitle{
  font-weight: 1100;
  letter-spacing: .8px;
  color: rgba(255,255,255,0.92);
}
.settingsClose{
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,0.12);
  background: rgba(255,255,255,0.06);
  color: rgba(255,255,255,0.92);
  padding: 8px 12px;
  font-weight: 1000;
  cursor:pointer;
}

.settingsBody{
  padding: 12px 12px 14px 12px;
  overflow: auto;
  -webkit-overflow-scrolling: touch;
  color: rgba(255,255,255,0.92);
}

.settingsRow{
  display:flex;
  gap: 10px;
  flex-wrap: wrap;
  margin-top: 12px;
}
.settingsChip{
  flex: 1 1 120px;
  border-radius: 16px;
  padding: 12px 12px;
  border: 1px solid rgba(255,255,255,0.10);
  background: rgba(255,255,255,0.04);
  color: rgba(255,255,255,0.92);
  font-weight: 1000;
  cursor: pointer;
  text-align:center;
}
.modeToggle{
  display:flex;
  gap: 10px;
}
.modeToggle .settingsChip.active{
  border-color: rgba(255,153,0,0.55);
  background: rgba(255,153,0,0.18);
}
.settingsHint{
  margin-top: 10px;
  color: rgba(255,255,255,0.62);
  font-size: 12px;
  font-weight: 800;
  line-height: 1.35;
}


/* ===== Tema: Gündüz / Gece ===== */
body.theme-day{
  background: #f3f4f6 !important;
  color: #111827 !important;
}
body.theme-day .settingsPanel{
  background: rgba(255,255,255,0.98) !important;
  border-color: rgba(17,24,39,0.10) !important;
}
body.theme-day .settingsTitle,
body.theme-day .settingsBody{
  color: rgba(17,24,39,0.92) !important;
}
body.theme-day .settingsHint{ color: rgba(17,24,39,0.60) !important; }
body.theme-day .settingsClose{
  background: rgba(17,24,39,0.05) !important;
  border-color: rgba(17,24,39,0.12) !important;
  color: rgba(17,24,39,0.92) !important;
}
body.theme-day .settingsChip{
  background: rgba(17,24,39,0.04) !important;
  border-color: rgba(17,24,39,0.10) !important;
  color: rgba(17,24,39,0.92) !important;
}
body.theme-day .settingsChip.active{
  border-color: rgba(255,153,0,0.70) !important;
  background: rgba(255,153,0,0.18) !important;
  color: rgba(17,24,39,0.95) !important;
}

/* Gece modu zaten varsayılan koyu tema; sadece isimlendirme için sınıf */
body.theme-night{
  background: #0b1220 !important;
  color: rgba(255,255,255,0.92) !important;
}


/* ===== Tema butonları tıklama fix ===== */
#settingsOverlay.open, #settingsOverlay.open * { pointer-events: auto; }


body.theme-day .hint, body.theme-day .subhint, body.theme-day .infoText { color: rgba(11,18,32,0.70) !important; }
body.theme-day .notesHelp, body.theme-day .help { color: rgba(11,18,32,0.72) !important; }
body.theme-day .chip, body.theme-day .pill { background: rgba(255,255,255,0.45) !important; border-color: rgba(11,18,32,0.16) !important; }

/* ===== Ayarlar: Günler ===== */
.daysGrid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px;margin-top:10px}
.dayToggle{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:14px;border:1px solid rgba(255,255,255,.10);background:rgba(255,255,255,.06)}
.dayToggle input{width:18px;height:18px;accent-color: var(--accent);}
.dayToggle span{font-weight:800;letter-spacing:.2px}
.settingsRow{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-top:12px}
.settingsRow label{font-weight:800;opacity:.9}
.settingsRow select,.settingsRow input[type="number"]{flex:1;max-width:170px}


/* ===== Sınıf / Ders Ekle UI ===== */
.clRow{ display:flex; gap:10px; align-items:center; }
.clInp{
  flex: 1 1 auto;
  min-width: 0;
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,0.12);
  background: rgba(255,255,255,0.05);
  color: rgba(255,255,255,0.92);
  padding: 12px 12px;
  font-weight: 1000;
  outline: none;
}
body.theme-day .clInp{
  border-color: rgba(17,24,39,0.14);
  background: rgba(17,24,39,0.04);
  color: rgba(17,24,39,0.92);
}
.clBtn{
  flex: 0 0 auto;
  border-radius: 14px;
  padding: 12px 14px;
  border: 1px solid rgba(255,153,0,0.55);
  background: rgba(255,153,0,0.18);
  color: rgba(255,255,255,0.95);
  font-weight: 1100;
  cursor: pointer;
}
body.theme-day .clBtn{ color: rgba(17,24,39,0.95); }

.clList{
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,0.10);
  background: rgba(255,255,255,0.03);
  overflow: hidden;
}
body.theme-day .clList{
  border-color: rgba(17,24,39,0.10);
  background: rgba(17,24,39,0.03);
}
.clItem{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  padding: 10px 12px;
  border-bottom: 1px solid rgba(255,255,255,0.08);
}
body.theme-day .clItem{ border-bottom-color: rgba(17,24,39,0.10); }
.clItem:last-child{ border-bottom:none; }
.clName{ font-weight: 1000; }
.clDel{
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,0.12);
  background: rgba(255,255,255,0.06);
  color: rgba(255,255,255,0.92);
  padding: 8px 10px;
  font-weight: 1000;
  cursor:pointer;
}
body.theme-day .clDel{
  border-color: rgba(17,24,39,0.12);
  background: rgba(17,24,39,0.05);
  color: rgba(17,24,39,0.92);
}


/* ===== Saatler (Zaman Tablosu) ===== */
.hoursGrid{ display:flex; flex-direction:column; gap: 12px; }
.hoursRow{ display:flex; gap: 12px; }
.hoursCell{ flex: 1 1 0; min-width: 0; }
.hoursLbl{
  font-size: 12px;
  font-weight: 900;
  color: rgba(255,255,255,0.75);
  margin-bottom: 6px;
}
body.theme-day .hoursLbl{ color: rgba(17,24,39,0.70); }
.dkWrap{
  display:flex; align-items:center; gap: 8px;
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,0.12);
  background: rgba(255,255,255,0.05);
  padding: 0 10px;
  height: 44px;
}
body.theme-day .dkWrap{
  border-color: rgba(17,24,39,0.14);
  background: rgba(17,24,39,0.04);
}
.dkInp{
  flex: 1 1 auto;
  min-width: 0;
  border: none;
  background: transparent;
  color: rgba(255,255,255,0.92);
  font-weight: 1000;
  font-size: 14px;
  outline:none;
}
body.theme-day .dkInp{ color: rgba(17,24,39,0.92); }
.dkTxt{
  flex: 0 0 auto;
  font-weight: 1000;
  color: rgba(255,255,255,0.78);
}
body.theme-day .dkTxt{ color: rgba(17,24,39,0.70); }

@media (max-width: 420px){
  .hoursRow{ flex-direction:column; }
}


/* ===== Günler: aktif gün + ders satır editörü ===== */
.activeDaysGrid{
  display:grid;
  grid-template-columns: repeat(4, minmax(0, 1fr));
  gap: 10px;
}
@media (max-width: 420px){
  .activeDaysGrid{ grid-template-columns: repeat(3, minmax(0, 1fr)); }
}
.dayToggle{
  border-radius: 16px;
  padding: 12px 10px;
  border: 1px solid rgba(255,255,255,0.10);
  background: rgba(255,255,255,0.04);
  color: rgba(255,255,255,0.92);
  font-weight: 1100;
  cursor:pointer;
  text-align:center;
}
.dayToggle.on{
  border-color: rgba(255,153,0,0.55);
  background: rgba(255,153,0,0.18);
}
body.theme-day .dayToggle{
  border-color: rgba(17,24,39,0.12);
  background: rgba(17,24,39,0.04);
  color: rgba(17,24,39,0.92);
}
body.theme-day .dayToggle.on{
  border-color: rgba(255,153,0,0.70);
  background: rgba(255,153,0,0.18);
}

.lessonEditTable{
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,0.10);
  background: rgba(255,255,255,0.03);
  overflow:hidden;
}
body.theme-day .lessonEditTable{
  border-color: rgba(17,24,39,0.10);
  background: rgba(17,24,39,0.03);
}
.lessonEditHead, .lessonEditRow{
  display:grid;
  grid-template-columns: 44px 1fr 110px;
  gap: 10px;
  align-items:center;
  padding: 10px 10px;
}
.lessonEditHead{
  font-weight: 1100;
  color: rgba(255,255,255,0.72);
  border-bottom: 1px solid rgba(255,255,255,0.08);
}
body.theme-day .lessonEditHead{
  color: rgba(17,24,39,0.70);
  border-bottom-color: rgba(17,24,39,0.10);
}
.lessonEditRow{
  border-bottom: 1px solid rgba(255,255,255,0.08);
}
.lessonEditRow:last-child{ border-bottom:none; }

.leNo{
  font-weight: 1200;
  opacity: .9;
}
.leInp{
  width:100%;
  min-width:0;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,0.12);
  background: rgba(255,255,255,0.05);
  color: rgba(255,255,255,0.92);
  padding: 10px 10px;
  font-weight: 1000;
  outline:none;
}
body.theme-day .leInp{
  border-color: rgba(17,24,39,0.14);
  background: rgba(17,24,39,0.04);
  color: rgba(17,24,39,0.92);
}
.leTime{
  font-variant-numeric: tabular-nums;
}
@media (max-width: 420px){
  .lessonEditHead, .lessonEditRow{
    grid-template-columns: 38px 1fr 96px;
    gap: 8px;
  }
}


/* ===== Günler: select görünümü ===== */
.leSel{
  -webkit-appearance: none;
  appearance: none;
  background-image: linear-gradient(45deg, transparent 50%, rgba(255,255,255,0.70) 50%), 
                    linear-gradient(135deg, rgba(255,255,255,0.70) 50%, transparent 50%);
  background-position: calc(100% - 16px) 50%, calc(100% - 11px) 50%;
  background-size: 6px 6px, 6px 6px;
  background-repeat: no-repeat;
  padding-right: 32px;
}
body.theme-day .leSel{
  background-image: linear-gradient(45deg, transparent 50%, rgba(17,24,39,0.60) 50%), 
                    linear-gradient(135deg, rgba(17,24,39,0.60) 50%, transparent 50%);
}


/* ===== Ayarlar: Kaydet Butonu ===== */
.settingsSave{
  border-radius: 16px;
  padding: 10px 14px;
  border: 1px solid rgba(255,153,0,0.65);
  background: rgba(255,153,0,0.22);
  color: rgba(255,255,255,0.96);
  font-weight: 1100;
  cursor: pointer;
}
body.theme-day .settingsSave{
  color: rgba(17,24,39,0.96);
}
.settingsSave:active{ transform: translateY(1px); }


/* ===== Toast (Kaydedildi) ===== */
.toast{
  position: fixed;
  left: 50%;
  bottom: 18px;
  transform: translateX(-50%);
  max-width: calc(100vw - 24px);
  padding: 12px 14px;
  border-radius: 16px;
  border: 1px solid rgba(255,255,255,0.12);
  background: rgba(15,23,42,0.92);
  color: rgba(255,255,255,0.95);
  font-weight: 1100;
  font-size: 14px;
  opacity: 0;
  pointer-events: none;
  z-index: 9000;
  transition: opacity .18s ease, transform .18s ease;
}
.toast.show{
  opacity: 1;
  transform: translateX(-50%) translateY(-2px);
}
body.theme-day .toast{
  background: rgba(255,255,255,0.94);
  color: rgba(17,24,39,0.95);
  border-color: rgba(17,24,39,0.14);
}


/* ===== Web dropdown görünürlük fix (select/option) ===== */
.leSel, .leSel option{
  color: rgba(255,255,255,0.92);
}
body.theme-day .leSel, body.theme-day .leSel option{
  color: rgba(17,24,39,0.92);
}
/* bazı tarayıcılarda option arka planını da zorlamak gerekir */
body.theme-day .leSel option{ background: #ffffff; }
body.theme-night .leSel option{ background: #0b1220; }


/* ===== Ayarlar: select/clInp görünürlük (Gün seç / Ders sayısı) ===== */
select.clInp{
  -webkit-appearance: none;
  appearance: none;
  background-image: linear-gradient(45deg, transparent 50%, rgba(255,255,255,0.70) 50%), 
                    linear-gradient(135deg, rgba(255,255,255,0.70) 50%, transparent 50%);
  background-position: calc(100% - 16px) 50%, calc(100% - 11px) 50%;
  background-size: 6px 6px, 6px 6px;
  background-repeat: no-repeat;
  padding-right: 32px;
}
select.clInp, select.clInp option{
  color: rgba(255,255,255,0.92);
}
body.theme-day select.clInp, body.theme-day select.clInp option{
  color: rgba(17,24,39,0.92);
}
body.theme-day select.clInp option{ background:#ffffff; }
body.theme-night select.clInp option{ background:#0b1220; }


/* ===== Haftalık: Tema uyumu + daraltma ===== */
.weeklyGrid{
  width: 100%;
  overflow-x: auto;
}
.weeklyTable{
  width: 100%;
  border-collapse: separate;
  border-spacing: 6px;
  table-layout: fixed;
}
.weeklyTable th, .weeklyTable td{
  border-radius: 14px;
  padding: 8px 8px;
  vertical-align: top;
  word-break: break-word;
}
/* gece varsayılan */
.weeklyTable th{
  background: rgba(255,153,0,0.18);
  border: 1px solid rgba(255,153,0,0.35);
  color: rgba(255,255,255,0.92);
  font-weight: 1100;
  font-size: 12px;
}
.weeklyTable td{
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.10);
  color: rgba(255,255,255,0.92);
  font-size: 12px;
}
body.theme-day .weeklyTable th{
  background: rgba(255,153,0,0.22);
  border-color: rgba(255,153,0,0.45);
  color: rgba(17,24,39,0.95);
}
body.theme-day .weeklyTable td{
  background: rgba(17,24,39,0.04);
  border-color: rgba(17,24,39,0.12);
  color: rgba(17,24,39,0.92);
}
body.theme-day .wLes{ color: rgba(20,24,30,0.95) !important; }

/* Günleri daralt */
.weeklyTable th.dayHead{
  padding: 6px 6px;
  font-size: 11px;
}
/* Ders metni kısaltma görünümü */
.wCellLine{
  line-height: 1.15;
}
.wCellLine .wCls{
  font-weight: 1100;
  opacity: 0.95;
}
.wCellLine .wLes{
  opacity: 0.95;
}


/* ===== Haftalık: Gündüz modu yazı görünürlük fix (güvenli) ===== */
body.theme-day .weeklyTable th,
body.theme-day .weeklyTable td{
  color: rgba(17,24,39,0.92);
}
body.theme-day .weeklyTable td *,
body.theme-day .weeklyTable th *{
  color: rgba(17,24,39,0.92);
}


/* Day mode: weekly lesson text black (except day labels) */
body.day-mode .weekly-table .cell .lesson,
body.day-mode .weekly-table .cell .lesson-name,
body.day-mode .weekly-table td .lesson,
body.day-mode .weekly-table td .lesson-name {
  color: #000 !important;
}


/* Aktif Günler - mobil grid */
.activeDaysGrid{
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  gap:10px 12px;
  margin-top:8px;
}
.activeDayItem{
  display:flex;
  align-items:center;
  gap:10px;
  padding:10px 12px;
  border-radius:12px;
  background:rgba(255,255,255,0.04);
  border:1px solid rgba(255,255,255,0.10);
}
.activeDayItem input{ width:18px; height:18px; }
@media(max-width:480px){
  .activeDaysGrid{
    grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
  }
}


/* === Aktif Günler - 2 sütun (taşma yok) === */
.activeDaysGrid{
  display:grid !important;
  grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
  gap:10px 12px;
}
.activeDayItem{
  display:flex !important;
  align-items:center;
  gap:10px;
  padding:10px 12px;
  border-radius:12px;
  background:rgba(255,255,255,0.04);
  border:1px solid rgba(255,255,255,0.10);
  min-width: 0; /* içerik taşmasını engelle */
}
.activeDayItem span, .activeDayItem label{
  min-width:0;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}
@media (min-width: 640px){
  .activeDaysGrid{ grid-template-columns: repeat(3, minmax(0,1fr)) !important; }
}
}


/* === Aktif Günler: her satırda 2-3 kutu (taşma yok) === */
.activeDaysGrid{
  display:grid !important;
  grid-template-columns: repeat(2, minmax(0, 1fr)) !important; /* varsayılan: 2 sütun */
  gap:10px 12px;
  width:100%;
}
@media (min-width: 480px){
  .activeDaysGrid{ grid-template-columns: repeat(3, minmax(0, 1fr)) !important; } /* geniş ekranda 3 */
}
.activeDayItem{
  display:flex !important;
  align-items:center;
  gap:10px;
  padding:10px 12px;
  border-radius:12px;
  background:rgba(255,255,255,0.04);
  border:1px solid rgba(255,255,255,0.10);
  min-width:0;
}
.activeDayItem span, .activeDayItem label{
  min-width:0;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}


/* === Aktif Günler: her satırda 3 gün, alt satıra devam (etiketler görünür) === */
.activeDaysGrid{
  display:grid !important;
  grid-template-columns: repeat(3, minmax(0, 1fr)) !important; /* 3 sütun sabit */
  gap:10px 12px;
  width:100%;
}
@media (max-width: 420px){
  .activeDaysGrid{ grid-template-columns: repeat(2, minmax(0,1fr)) !important; } /* çok dar ekranda 2 */
}
.activeDayItem{
  display:flex !important;
  align-items:center;
  gap:10px;
  padding:10px 12px;
  border-radius:12px;
  background:rgba(255,255,255,0.04);
  border:1px solid rgba(255,255,255,0.10);
  min-width:0;
}
.activeDayItem label,
.activeDayItem span{
  white-space:nowrap; 
  overflow:visible; 
  text-overflow:unset;
}


/* === Aktif Günler: 3 sütun (3 satır), gün isimleri net === */
#activeDaysGrid.activeDaysGrid{
  display:grid !important;
  grid-template-columns: repeat(3, minmax(0, 1fr)) !important;
  gap:10px 12px;
  width:100%;
}
#activeDaysGrid .dayOption{
  display:flex;
  align-items:center;
  gap:10px;
  padding:10px 12px;
  border-radius:12px;
  background:rgba(255,255,255,0.04);
  border:1px solid rgba(255,255,255,0.10);
  min-width:0;
}
#activeDaysGrid .dayOption .dayChk{ width:18px; height:18px; flex:0 0 auto; }
#activeDaysGrid .dayOption .dayName{
  font-weight:800;
  letter-spacing:0.3px;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
@media (max-width: 360px){
  #activeDaysGrid.activeDaysGrid{ grid-template-columns: repeat(2, minmax(0,1fr)) !important; }
}


/* === Bölüm ayraçları daha belirgin === */
hr.soft{
  border: none;
  height: 1px;
  background: linear-gradient(90deg, rgba(255,122,0,0.0), rgba(255,122,0,0.55), rgba(255,122,0,0.0));
  margin: 18px 0;
}

.settingsCard{
  border:1px solid rgba(255,122,0,0.35) !important;
  box-shadow: inset 0 0 0 1px rgba(255,122,0,0.08);
}

.sectionTitle{
  padding-bottom:6px;
  margin-bottom:10px;
  border-bottom:1px solid rgba(255,122,0,0.45);
}



/* === Bölüm ayraçları başlığın ÜSTÜNDE === */
.sectionTitle{
  padding-top:10px;
  margin-top:20px;
  border-top:1px solid rgba(255,122,0,0.55);
  padding-bottom:6px;
  margin-bottom:10px;
  border-bottom:none; /* alt çizgiyi kaldır */
}



  .planInp.planTime{opacity:0.95;}
  .planInp.planTime[]{cursor:default;}

/* === Gün Programı girişlerini garanti aktif yap === */
.overlay.open{ pointer-events:auto; }
.overlay.open .panel{ pointer-events:auto; z-index:2; }
.overlay.open .backdrop{ z-index:1; }
#planRows, .planRow, .planCell, .planTableWrap{ pointer-events:auto; }
.planInp{ pointer-events:auto !important; -webkit-user-select:text !important; user-select:text !important; }


/* compact-fix28 */
.col-dot{width:14px;min-width:14px}
.col-no{width:22px;min-width:22px;text-align:center}
.col-class{width:44px;min-width:44px}
.col-time{width:78px;min-width:78px;text-align:right;color:#9aa}
.dotBtn{width:12px;height:12px}
.dot{width:6px;height:6px}
.row{padding-left:4px;padding-right:6px}


/* fix29 header + spacing */
.table-header{display:grid;grid-template-columns:16px 28px 44px 1fr 84px;align-items:center;padding:6px 6px 6px 4px}
.row{display:grid;grid-template-columns:16px 28px 44px 1fr 84px;align-items:center;padding:6px 6px 6px 4px}
.col-dot{width:16px;min-width:16px}
.col-no{width:28px;min-width:28px;text-align:center}
.col-class{width:44px;min-width:44px}
.col-time{width:84px;min-width:84px;text-align:right;white-space:nowrap;overflow:visible;color:#9aa}
.col-lesson{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.table-header .h-saat{order:5;text-align:right}
.table-header .h-sinif{order:3}
.table-header .h-ders{order:4}
.left-gutter{padding-left:2px}

</style>

<style>
/* Haftalık - Gündüz modunda yazılar siyah (gün etiketleri hariç) */
body.light .weekly-table,
body.light .weekly-table td,
body.light .weekly-table th,
body.light .weekly-cell,
body.light .weekly-cell .lesson,
body.light .weekly-cell .cls,
body.light .weekly-cell .time {
  color: #111 !important;
}

/* Gün etiketlerini (PZT, SAL, ...) beyaz bırak */
body.light .weekly-day,
body.light .weekly-day-label {
  color: #fff !important;
}

/* Day mode: weekly lesson text black (except day labels) */
body.day-mode .weekly-table .cell .lesson,
body.day-mode .weekly-table .cell .lesson-name,
body.day-mode .weekly-table td .lesson,
body.day-mode .weekly-table td .lesson-name {
  color: #000 !important;
}


/* compact-fix28 */
.col-dot{width:14px;min-width:14px}
.col-no{width:22px;min-width:22px;text-align:center}
.col-class{width:44px;min-width:44px}
.col-time{width:78px;min-width:78px;text-align:right;color:#9aa}
.dotBtn{width:12px;height:12px}
.dot{width:6px;height:6px}
.row{padding-left:4px;padding-right:6px}


/* fix29 header + spacing */
.table-header{display:grid;grid-template-columns:16px 28px 44px 1fr 84px;align-items:center;padding:6px 6px 6px 4px}
.row{display:grid;grid-template-columns:16px 28px 44px 1fr 84px;align-items:center;padding:6px 6px 6px 4px}
.col-dot{width:16px;min-width:16px}
.col-no{width:28px;min-width:28px;text-align:center}
.col-class{width:44px;min-width:44px}
.col-time{width:84px;min-width:84px;text-align:right;white-space:nowrap;overflow:visible;color:#9aa}
.col-lesson{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.table-header .h-saat{order:5;text-align:right}
.table-header .h-sinif{order:3}
.table-header .h-ders{order:4}
.left-gutter{padding-left:2px}

</style>


<style>
/* FORCE: Weekly lesson names black in DAY mode */
body.light-mode .weekly-table .lesson,
body.light-mode .weekly-table .week-cell .lesson,
body.light-mode .weekly-table td .lesson,
body.light-mode .weekly-table .cell-lesson,
body.light-mode .weekly-table .cell .lesson {
    color: #000 !important;
}

/* compact-fix28 */
.col-dot{width:14px;min-width:14px}
.col-no{width:22px;min-width:22px;text-align:center}
.col-class{width:44px;min-width:44px}
.col-time{width:78px;min-width:78px;text-align:right;color:#9aa}
.dotBtn{width:12px;height:12px}
.dot{width:6px;height:6px}
.row{padding-left:4px;padding-right:6px}


/* fix29 header + spacing */
.table-header{display:grid;grid-template-columns:16px 28px 44px 1fr 84px;align-items:center;padding:6px 6px 6px 4px}
.row{display:grid;grid-template-columns:16px 28px 44px 1fr 84px;align-items:center;padding:6px 6px 6px 4px}
.col-dot{width:16px;min-width:16px}
.col-no{width:28px;min-width:28px;text-align:center}
.col-class{width:44px;min-width:44px}
.col-time{width:84px;min-width:84px;text-align:right;white-space:nowrap;overflow:visible;color:#9aa}
.col-lesson{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.table-header .h-saat{order:5;text-align:right}
.table-header .h-sinif{order:3}
.table-header .h-ders{order:4}
.left-gutter{padding-left:2px}

</style>

<style id="settings-new">

/* ===== Yeni Ayarlar Sayfası (Overlay) ===== */
.settingsBtn{
  position: fixed;
  top: 12px;
  right: 12px;
  width: 44px;
  height: 44px;
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,.12);
  background: rgba(255,255,255,.06);
  color: rgba(255,255,255,.92);
  font-size: 20px;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  z-index: 5000;
  -webkit-tap-highlight-color: transparent;
}
body.theme-day .settingsBtn{
  color: rgba(17,24,39,.92);
  border-color: rgba(17,24,39,.12);
  background: rgba(17,24,39,.05);
}
.overlay{ position:fixed; inset:0; display:none; z-index:6000; }
.overlay.open{ display:block; }
.backdrop{ position:absolute; inset:0; background: rgba(0,0,0,.55); }
.panel{
  position:absolute; left:50%; top:50%; transform: translate(-50%,-50%);
  width: min(520px, calc(100vw - 22px));
  max-height: min(82vh, 760px);
  overflow:hidden;
  border-radius: 18px;
  border: 1px solid rgba(255,255,255,.10);
  background: rgba(10,18,32,.98);
  box-shadow: 0 18px 60px rgba(0,0,0,.55);
  display:flex; flex-direction:column;
}
body.theme-day .panel{ background: rgba(255,255,255,.98); border-color: rgba(17,24,39,.10); }
.top{
  padding: 12px;
  display:flex; align-items:center; justify-content:space-between; gap:10px;
  border-bottom:1px solid rgba(255,255,255,.08);

  position: sticky;
  top: 0;
  z-index: 2;
  background: rgba(10,18,32,.98);
}
body.theme-day .top{ border-bottom-color: rgba(17,24,39,.10); }
.top .ttl{ font-weight: 1100; letter-spacing: .8px; }
.body{ padding: 12px; overflow:auto; -webkit-overflow-scrolling:touch; }
hr.soft{ border:none; height:1px; background: rgba(255,255,255,.08); margin: 10px 0; }
body.theme-day hr.soft{ background: rgba(17,24,39,.10); }

.rowInline{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; }

.spacer{ display:none; flex-basis:100%; height:0; }

@media (max-width: 520px){
  .panel{
    top: 50%;
    max-height: calc(100vh - 18px);
    width: calc(100vw - 16px);
    border-radius: 16px;
  }
  .top{ padding: 10px 10px; }
  .ttl{ font-size: 18px; letter-spacing: .6px; }
  .body{ padding: 10px; }
  .rowInline{ gap:10px; }
  .spacer{ display:block; }
  .miniSelect{ flex: 1 1 160px; }
  .miniBtn{ padding: 6px 10px; font-size: 12px; }
  .sectionTitle{ font-size: 18px; }
  .timeGrid{ grid-template-columns: repeat(2, 1fr); gap:8px; }
  .programTop{ flex-wrap: wrap; }
  .programTop .miniSelect{ flex: 1 1 140px; }
}

.small{ font-weight: 800; opacity: .9; }

.miniBtn{
  padding: 5px 9px;
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,.20);
  background: rgba(255,255,255,.05);
  color: inherit;
  font-weight: 900;
  font-size: 12px;
  cursor:pointer;
}
.miniBtn.active{ background: rgba(255,122,0,.18); border-color: rgba(255,122,0,.55); }
body.theme-day .miniBtn{ border-color: rgba(17,24,39,.18); background: rgba(17,24,39,.04); }
body.theme-day .miniBtn.active{ border-color: rgba(255,122,0,.70); background: rgba(255,122,0,.18); }

.miniSelect{
  padding: 5px 9px;
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,.20);
  background: rgba(255,255,255,.05);
  color: inherit;
  font-weight: 800;
}
body.theme-day .miniSelect{ border-color: rgba(17,24,39,.18); background: rgba(17,24,39,.04); }

.sectionTitle{ font-weight: 1000; letter-spacing:.4px; margin: 0 0 8px; }

.timeGrid{ display:grid; grid-template-columns: repeat(2, 1fr); gap:10px; }
@media(max-width:420px){ .timeGrid{ grid-template-columns: repeat(2, 1fr); gap:8px; } .timeCell label{ margin:0 0 4px; } .timeCell input{ padding: 8px 10px; border-radius: 11px; } }
.timeCell label{ display:block; font-size:12px; opacity:.80; font-weight:900; margin:0 0 6px; }
.timeCell input{
  width:100%; box-sizing:border-box;
  padding: 10px 12px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,.20);
  background: rgba(255,255,255,.05);
  color: inherit;
  font-weight: 900;
}
body.theme-day .timeCell input{ border-color: rgba(17,24,39,.18); background: rgba(17,24,39,.04); }

.inlineInput{ display:flex; align-items:center; gap:8px; }
.inlineInput span{ font-weight: 900; opacity:.7; }

.pairGrid{ display:grid; grid-template-columns: repeat(2,1fr); gap:10px; margin-top:8px; }
@media(max-width:420px){ .pairGrid{ grid-template-columns: 1fr; } }
.pairRow3{ display:grid; grid-template-columns: 1fr 1fr 110px; gap:10px; margin-top:8px; align-items:end; }
.pairBtnCell .miniBtn{ width:100%; padding: 10px 10px; border-radius: 14px; }
@media(max-width:420px){
  .pairRow3{ grid-template-columns: 1fr 1fr 92px; gap:8px; }
  .pairBtnCell .miniBtn{ padding: 10px 8px; font-size: 12px; }
}

.pairCell label{ display:block; font-size:12px; opacity:.80; font-weight:900; margin:0 0 6px; }
.pairCell input{
  width:100%; box-sizing:border-box;
  padding: 10px 12px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,.20);
  background: rgba(255,255,255,.05);
  color: inherit;
  font-weight: 900;
}
body.theme-day .pairCell input{ border-color: rgba(17,24,39,.18); background: rgba(17,24,39,.04); }

.pairActions{ display:flex; align-items:center; gap:10px; margin-top:10px; }
.muteline{ opacity:.75; font-weight:800; font-size:12px; }

.pairTableWrap, .daysTableWrap, .planTableWrap{
  margin-top:10px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.10);
  background: rgba(255,255,255,.03);
  overflow:hidden;
}
body.theme-day .pairTableWrap,
body.theme-day .daysTableWrap,
body.theme-day .planTableWrap{
  border-color: rgba(17,24,39,.10);
  background: rgba(17,24,39,.03);
}

.pairTable, .daysTable{ width:100%; border-collapse: separate; border-spacing:0; }
.pairTable th, .pairTable td, .daysTable th, .daysTable td{
  padding: 10px 10px;
  border-bottom:1px solid rgba(255,255,255,.08);
  text-align:left;
  font-weight:900;
  font-size:13px;
}

/* Aktif günler - kutucuk düzeni (2 sütun) */
.activeDaysGrid{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap: 14px 22px;
}
@media (max-width: 520px){
  .activeDaysGrid{ grid-template-columns: 1fr; }
}
.dayOption{
  display:flex;
  align-items:center;
  gap:12px;
  padding: 2px 4px;
  user-select:none;
}
.dayOption input[type="checkbox"]{
  width:18px;
  height:18px;
  accent-color: var(--orange);
}
.dayName{
  letter-spacing: .4px;
  font-weight: 900;
  color: rgba(255,255,255,.92);
}
body.theme-day .dayName{ color: rgba(17,24,39,.92); }
body.theme-day .pairTable th, body.theme-day .pairTable td,
body.theme-day .daysTable th, body.theme-day .daysTable td{
  border-bottom-color: rgba(17,24,39,.10);
}
.pairTable th, .daysTable th{ opacity:.75; font-size:12px; letter-spacing:.6px; }
.pairTable tr:last-child td, .daysTable tr:last-child td{ border-bottom:none; }

.dayChk{ width:18px; height:18px; accent-color: var(--orange); }

.planHead, .planRow{
  display:grid;
  grid-template-columns: 34px 1fr 1fr 1.2fr;
  gap: 8px;
  align-items:center;
  padding: 10px 10px;
}
.planHead{
  font-weight:900;
  opacity:.75;
  font-size:12px;
  letter-spacing:.6px;
  border-bottom:1px solid rgba(255,255,255,.08);
}
body.theme-day .planHead{ border-bottom-color: rgba(17,24,39,.10); }
.planRow{ border-bottom:1px solid rgba(255,255,255,.08); }
.planRow:last-child{ border-bottom:none; }
.planNo{ text-align:center; font-weight:1000; color: var(--orange); }
.planInp{
  width:100%;
  box-sizing:border-box;
  padding: 9px 10px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,.20);
  background: rgba(255,255,255,.05);
  color: inherit;
  font-weight: 900;
pointer-events:auto; -webkit-user-select:text; user-select:text; }

body.theme-day .planInp{ border-color: rgba(17,24,39,.18); background: rgba(17,24,39,.04); }
@media(max-width:420px){
  /* Mobilde DERS alanını gizleme: sınıfın sağına göster */
  .planHead, .planRow{ grid-template-columns: 30px 1.15fr 0.95fr 1.15fr; }
  .planHead{ font-size: 12px; }
  .planNo{ font-size: 13px; }
  .planInp{ padding: 8px 9px; border-radius: 12px; }
}


/* === Üstte Kaydet/Kapat hizası === */
.topActions{ display:flex; gap:8px; align-items:center; }
.miniBtn.primary{
  border-color: rgba(255,122,0,.55);
  background: rgba(255,122,0,.18);
}
body.theme-day .miniBtn.primary{
  border-color: rgba(255,122,0,.70);
  background: rgba(255,122,0,.18);
}

/* === Tema + Yazı Boyutu yan yana hizalı === */
.rowInline.rowAlign{
  justify-content: space-between;
  gap: 12px;
}
.inlineGroup{
  display:flex;
  align-items:center;
  gap:8px;
  flex: 0 0 auto;
}
@media (max-width: 520px){
  .rowInline.rowAlign{
    flex-wrap: wrap;
    justify-content: flex-start;
  }
  .inlineGroup{ flex: 1 1 auto; }
  .miniSelect{ min-width: 160px; }
}


/* === Ayarlar: alan araları + turuncu çizgi belirginliği === */
.body{ padding: 16px 14px !important; }
.sectionTitle{ margin-top: 26px !important; margin-bottom: 14px !important; }
hr.soft{
  height: 2px !important;
  background: linear-gradient(90deg, rgba(255,122,0,0.0), rgba(255,122,0,0.85), rgba(255,122,0,0.0)) !important;
  margin: 18px 0 20px !important;
}
.settingsCard{
  border:1px solid rgba(255,122,0,0.55) !important;
  box-shadow: inset 0 0 0 1px rgba(255,122,0,0.18), 0 6px 16px rgba(0,0,0,0.25) !important;
}
.rowInline{ margin-bottom: 12px !important; }
.timeGrid{ gap:14px !important; }
.pairGrid{ gap:14px !important; }
.pairRow3{ margin-top:14px !important; }
.pairActions{ margin-top:14px !important; }
.pairTableWrap, .daysTableWrap, .planTableWrap{
  margin-top:14px !important;
  border-color: rgba(255,122,0,0.45) !important;
}
.planHead{ border-bottom:2px solid rgba(255,122,0,0.45) !important; }
.planRow{ border-bottom:1px solid rgba(255,122,0,0.35) !important; }


/* === Gün + Ders Sayısı yan yana === */
.programTopInline{
  justify-content: space-between;
  gap: 16px;
}
.programTopInline .inlineGroup{
  flex: 1 1 0;
}


/* === Gün + Gün Sayısı + Ders Sayısı tek satır === */
.programTopInline{ align-items: center; }
.programTopInline .inlineGroup{ gap:8px; }
@media (max-width: 520px){
  .programTopInline{ flex-wrap: wrap; }
  .programTopInline .inlineGroup{ flex: 1 1 100%; }
}


/* === Üst: Gün + Gün Sayısı + Ders (kompakt) === */
.compactTop{ justify-content:flex-start; gap:10px; }
.dayGroup{ flex-wrap:wrap; align-items:center; }
.miniNarrow{ min-width:120px; max-width:140px; }
.miniTiny{ min-width:64px; max-width:72px; text-align:center; padding-left:6px; padding-right:22px; }
@media (max-width: 520px){
  .dayGroup{ gap:8px; }
  .miniNarrow{ min-width:110px; max-width:120px; }
  .miniTiny{ min-width:58px; max-width:64px; }
}


/* === Gün + Gün Sayısı + Ders tek satır, kesin hizalı === */
.programTopRow{ display:flex; }
.dayRow{
  display:flex;
  align-items:center;
  gap:8px;
  flex-wrap:nowrap;
}
.dayWide{
  min-width:140px;
  max-width:160px;
}
.miniTiny{
  min-width:60px;
  max-width:68px;
  text-align:center;
  padding-left:6px;
  padding-right:22px;
}
@media (max-width: 480px){
  .dayWide{ min-width:120px; max-width:130px; }
  .miniTiny{ min-width:56px; max-width:60px; }
}


/* === Ders Sayısı select daralt === */
#lessonCountSelect{
  min-width: 64px !important;
  max-width: 72px !important;
  width: 72px !important;
  text-align: center;
  padding-left: 6px !important;
  padding-right: 22px !important;
  box-sizing: border-box;
}
#dayCountSelect{
  min-width: 64px !important;
  max-width: 72px !important;
  width: 72px !important;
  text-align: center;
  padding-left: 6px !important;
  padding-right: 22px !important;
}
#daySelect{
  min-width: 120px !important;
  max-width: 140px !important;
  width: 140px !important;
}
@media (max-width: 480px){
  #lessonCountSelect, #dayCountSelect{
    min-width: 56px !important;
    max-width: 60px !important;
    width: 60px !important;
  }
  #daySelect{
    min-width: 110px !important;
    max-width: 120px !important;
    width: 120px !important;
  }
}


/* === Üst: Gün dar + Ders Sayısı yanına 8 === */
.compactRow{ display:flex; }
.compactRowInner{
  display:flex;
  align-items:center;
  gap:8px;
  flex-wrap:nowrap;
}
.dayNarrow{
  min-width:110px !important;
  max-width:120px !important;
  width:120px !important;
}
.tinySelect{
  min-width:56px !important;
  max-width:64px !important;
  width:64px !important;
  text-align:center;
  padding-left:6px !important;
  padding-right:22px !important;
}
@media (max-width: 480px){
  .dayNarrow{ min-width:100px !important; max-width:110px !important; width:110px !important; }
  .tinySelect{ min-width:52px !important; max-width:56px !important; width:56px !important; }
}


/* === Gün Programı üst satır: Gün + Ders Sayısı aynı satırda kalsın === */
.rowInline.gunPlanTop{ flex-wrap: nowrap; align-items: center; gap: 10px; }
#dayPlanSelect.dayNarrow{
  min-width: 120px !important;
  max-width: 140px !important;
  width: 140px !important;
}
#lessonCountSelect.tinySelect{
  min-width: 58px !important;
  max-width: 64px !important;
  width: 64px !important;
  text-align: center;
  padding-left: 6px !important;
  padding-right: 22px !important;
}
@media (max-width: 480px){
  #dayPlanSelect.dayNarrow{ min-width: 110px !important; max-width: 120px !important; width: 120px !important; }
  #lessonCountSelect.tinySelect{ min-width: 52px !important; max-width: 56px !important; width: 56px !important; }
}


/* === Gündüz modu: Kaydet / Kapat yazıları görünür olsun === */
body.theme-day .topActions .miniBtn,
body.light .topActions .miniBtn,
body.light-mode .topActions .miniBtn{
  color: #111 !important;
  border-color: rgba(17,24,39,0.35) !important;
  background: rgba(255,255,255,0.85) !important;
}

body.theme-day .topActions .miniBtn.primary,
body.light .topActions .miniBtn.primary,
body.light-mode .topActions .miniBtn.primary{
  color: #111 !important;
  background: rgba(255,122,0,0.35) !important;
  border-color: rgba(255,122,0,0.85) !important;
}


/* === Bölümler arası çizgi daha kalın === */
hr.soft{
  height: 3px !important;
  background: linear-gradient(90deg,
    rgba(255,122,0,0.0),
    rgba(255,122,0,0.95),
    rgba(255,122,0,0.0)
  ) !important;
  margin: 20px 0 22px !important;
}

.sectionTitle{
  border-top: 2px solid rgba(255,122,0,0.75) !important;
  padding-top: 12px !important;
}


/* === Ayarlar: daha sade/zarif görünüm (buton & boşluk küçültme) === */
.overlay.open .panel{ padding: 14px 14px 16px !important; }  /* içeri al */
.settingsCard{ padding: 14px 12px !important; }             /* kart içi ferah ama daha kompakt */

.top{ padding: 2px 0 10px !important; }
.ttl{ font-size: 18px !important; letter-spacing: 1.2px !important; }

.topActions .miniBtn{
  padding: 8px 10px !important;
  border-radius: 12px !important;
  font-size: 13px !important;
}

/* Gece/Gündüz butonları + Yazı seçimi daha küçük */
.modeBtn, .miniBtn{
  padding: 8px 10px !important;
  border-radius: 12px !important;
  font-size: 13px !important;
}

/* Select’ler (Yazı/ Gün / Ders Sayısı vb.) küçült */
.miniSelect{
  padding: 8px 10px !important;
  border-radius: 12px !important;
  font-size: 13px !important;
}

/* Tema satırı hizası daha kompakt */
.rowInline.rowAlign{ gap: 10px !important; }
.inlineGroup{ gap: 8px !important; }
.small{ font-size: 13px !important; opacity: .92; }

/* Bölüm başlıklarını biraz küçült */
.sectionTitle{
  font-size: 20px !important;
  margin-top: 22px !important;
}

/* Tablo hücre input/select görünümleri daha zarif */
.planInp, .pairInp, input[type="number"], input[type="text"]{
  padding: 10px 12px !important;
  border-radius: 14px !important;
  font-size: 14px !important;
}

/* Mobilde daha da sıkı */
@media (max-width: 420px){
  .topActions .miniBtn{ padding: 7px 9px !important; font-size: 12.5px !important; }
  .miniSelect{ padding: 7px 9px !important; font-size: 12.5px !important; }
  .sectionTitle{ font-size: 19px !important; }
}


/* === İnce hizalama: AYARLAR başlığı, yazı boyutu, kaydet/kapat === */

/* AYARLAR başlığı biraz içeri */
.top{
  padding-left: 6px !important;
  padding-right: 6px !important;
}
.ttl{
  margin-left: 6px !important;
}

/* Kaydet/Kapat: biraz büyüt + sola kaydır (sağa çok yapışmasın) */
.topActions{
  margin-right: 6px !important;
}
.topActions .miniBtn{
  padding: 9px 12px !important;
  font-size: 13.5px !important;
}
.topActions{ gap: 10px !important; }

/* Yazı boyutu seçimi genişliğini küçült */
#fontSizeSelect.miniSelect{
  min-width: 118px !important;
  width: 118px !important;
  max-width: 118px !important;
  padding-right: 26px !important;
}

/* Tema satırındaki 'Yazı' bölümünü taşırma yapmadan sığdır */
.rowInline.rowAlign .inlineGroup{
  flex-wrap: nowrap;
}


/* === Üst şerit boşluk: AYARLAR + Kaydet/Kapat aşağı al === */
.top{
  padding-top: 10px !important;
}
.ttl{
  margin-top: 6px !important;
}
.topActions{
  margin-top: 6px !important;
}

/* === Zaman Tablosu alanları: eşit boyut + biraz küçült === */
.timeGrid{
  gap: 10px !important;
}
.timeGrid .miniSelect,
.timeGrid input[type="number"],
.timeGrid input[type="text"]{
  min-width: 120px !important;
  max-width: 120px !important;
  width: 120px !important;
  padding: 8px 10px !important;
  border-radius: 12px !important;
  font-size: 13px !important;
}

/* Etiket hizaları */
.timeGrid .lbl{
  font-size: 13px !important;
  margin-bottom: 4px !important;
}

/* dk etiketleri içeri al */
.timeGrid .unit{
  margin-left: 6px !important;
}

/* Mobil daha da kompakt */
@media (max-width: 420px){
  .timeGrid .miniSelect,
  .timeGrid input[type="number"],
  .timeGrid input[type="text"]{
    min-width: 110px !important;
    max-width: 110px !important;
    width: 110px !important;
    padding: 7px 9px !important;
    font-size: 12.5px !important;
  }
}


/* === Kaydet/Kapat biraz daha sola === */
.topActions{
  margin-right: 16px !important; /* sağdan içeri */
}

/* === Başlangıç Saati de diğerleri gibi küçük ve eşit === */
.timeGrid #startTimeSelect,
.timeGrid select#startTime,
.timeGrid .startTime,
.timeGrid .timeStart{
  min-width: 120px !important;
  max-width: 120px !important;
  width: 120px !important;
  padding: 8px 10px !important;
  border-radius: 12px !important;
  font-size: 13px !important;
}

/* Eğer ID farklıysa tüm timeGrid selectleri eşitle */
.timeGrid select{
  min-width: 120px !important;
  max-width: 120px !important;
  width: 120px !important;
  padding: 8px 10px !important;
  border-radius: 12px !important;
  font-size: 13px !important;
}

@media (max-width: 420px){
  .topActions{ margin-right: 10px !important; }
  .timeGrid select{
    min-width: 110px !important;
    max-width: 110px !important;
    width: 110px !important;
    padding: 7px 9px !important;
    font-size: 12.5px !important;
  }
}


/* === ÜST ŞERİT: AYARLAR + KAYDET/KAPAT aşağı ve sola (resme göre) === */
.header, .top, .panelHeader{
  padding-top: 14px !important; /* üst şeritten aşağı */
}
.ttl, .title{
  margin-top: 10px !important;
  margin-left: 10px !important; /* soldan içeri */
}

/* Kaydet/Kapat: sola kaydır ve biraz aşağı al */
.topActions, .headerActions{
  margin-top: 10px !important;
  margin-right: 18px !important; /* sağdan içeri -> sola gelmiş gibi */
}
.topActions .miniBtn, .headerActions .miniBtn{
  padding: 10px 14px !important;
  font-size: 14px !important;
}

/* === SAAT TABLOSU: tüm alanları eşit ve daha küçük === */
.timeGrid,
.timeGrid *{
  box-sizing: border-box;
}

.timeGrid select,
.timeGrid input{
  min-width: 110px !important;
  max-width: 110px !important;
  width: 110px !important;
  padding: 7px 9px !important;
  border-radius: 12px !important;
  font-size: 12.5px !important;
}

/* dk etiketlerini hizala */
.timeGrid .unit{
  margin-left: 6px !important;
}

/* Mobil ekstra sıkı */
@media (max-width: 420px){
  .timeGrid select,
  .timeGrid input{
    min-width: 104px !important;
    max-width: 104px !important;
    width: 104px !important;
    padding: 6px 8px !important;
    font-size: 12px !important;
  }
}


/* === Scroll'da günlerin altında bozuk (blur) görüntü fix ===
   Android/WebView'de sticky + backdrop-filter bazen "smear" yapıyor.
   Çözüm: topbar'ı solid yapıp blur'u kapat, içerikleri düzgün kliple.
*/
.topbar{
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
  background: rgba(11,18,32,0.96) !important;
  box-shadow: 0 10px 22px rgba(0,0,0,0.28);
  border-bottom: 1px solid rgba(255,122,0,0.22);
  overflow: hidden;           /* blur kaynaklı taşmaları kes */
  transform: translateZ(0);   /* katman sabitle */
}

/* Gün sekmeleri alanı arka planı: alttan taşma görüntüsünü kapatır */
.dayTabs{
  padding-bottom: 10px !important;
}
.dayTabs::after{
  content:"";
  position:absolute;
  left:0; right:0; bottom:0;
  height: 14px;
  background: rgba(11,18,32,0.96);
  pointer-events:none;
}

/* dayTabs absolute pseudo için konteyneri relative yap */
.dayTabs{ position: relative; }


/* === Gün butonları kesilmesin: alt kapatma bandını aşağı kaydır === */
.dayTabs{
  padding-bottom: 14px !important; /* buton altına nefes */
}
.dayTabs::after{
  height: 10px !important;
  bottom: -10px !important; /* bandı konteynerin altına indir, butonu örtmesin */
  background: rgba(11,18,32,0.96) !important;
}


/* === Anasayfa: Sınıf beyaz, Ders turuncu === */
.class, .cls, .cClass{
  color: #ffffff !important;
  opacity: .95 !important;
  font-weight: 700;
}
.lesson, .les, .cLesson{
  color: var(--orange) !important;
  font-weight: 900 !important;
  letter-spacing: .3px;
}
.time{
  color: rgba(255,255,255,0.65) !important;
}


/* === Anasayfa satır sıkılaştırma: numara çevresi dar, ders alanı geniş === */
.row{padding-left:4px;padding-right:6px;
  /* dot + no + sınıf + ders + zaman */
  grid-template-columns: 18px 28px 58px 1.8fr 0.7fr !important;
  column-gap: 8px !important;
}

/* numara daha dar */
.no, .idx, .num{
  width: 28px !important;
  min-width: 28px !important;
  text-align: right;
}

/* dot alanı dar */
.dotBtn{width:12px;height:12px; width: 18px !important; height: 18px !important; }

/* sınıf biraz dar */
.class, .cls, .cClass{
  width: 58px !important;
  min-width: 58px !important;
}

/* ders daha geniş */
.lesson, .les, .cLesson{
  padding-right: 6px !important;
}

/* zaman daha dar ve sağa yaslı */
.time{
  width: 84px !important;
  min-width: 84px !important;
  text-align: right !important;
}

/* mobil ekstra sıkı */
@media (max-width: 420px){
  .row{padding-left:4px;padding-right:6px;
    grid-template-columns: 16px 26px 54px 1.9fr 0.6fr !important;
    column-gap: 6px !important;
  }
  .time{ width: 78px !important; min-width: 78px !important; }
}


/* === Başlık sırası: Sınıf | Ders | Saat === */
/* Eğer header grid kullanıyorsa aynı kolon sırasını uygula */
.headerRow, .headRow{
  display:grid;
  grid-template-columns: 12px 28px 54px 1.9fr 0.6fr !important; /* dot, no, sınıf, ders, saat */
  column-gap: 6px !important;
}
.headerRow .time, .headRow .time{ text-align:right !important; }

/* === Nokta alanını daha da daralt === */
.dotBtn{width:12px;height:12px;
  width: 12px !important;
  height: 12px !important;
}
.dot{width:6px;height:6px;
  width: 8px !important;
  height: 8px !important;
}
.row{padding-left:4px;padding-right:6px;
  grid-template-columns: 12px 26px 54px 1.9fr 0.6fr !important;
  column-gap: 6px !important;
}

/* numara alanı dar */
.no, .idx, .num{
  width: 26px !important;
  min-width: 26px !important;
  text-align: right;
}

/* sınıf biraz daha dar */
.class, .cls, .cClass{
  width: 54px !important;
  min-width: 54px !important;
}

/* saat dar ve sağa yaslı */
.time{
  width: 72px !important;
  min-width: 72px !important;
  text-align: right !important;
}

@media (max-width: 420px){
  .row, .headerRow, .headRow{
    grid-template-columns: 10px 24px 50px 2fr 0.55fr !important;
    column-gap: 5px !important;
  }
  .time{ width: 66px !important; min-width: 66px !important; }
}


/* compact-fix28 */
.col-dot{width:14px;min-width:14px}
.col-no{width:22px;min-width:22px;text-align:center}
.col-class{width:44px;min-width:44px}
.col-time{width:78px;min-width:78px;text-align:right;color:#9aa}
.dotBtn{width:12px;height:12px}
.dot{width:6px;height:6px}
.row{padding-left:4px;padding-right:6px}


/* fix29 header + spacing */
.table-header{display:grid;grid-template-columns:16px 28px 44px 1fr 84px;align-items:center;padding:6px 6px 6px 4px}
.row{display:grid;grid-template-columns:16px 28px 44px 1fr 84px;align-items:center;padding:6px 6px 6px 4px}
.col-dot{width:16px;min-width:16px}
.col-no{width:28px;min-width:28px;text-align:center}
.col-class{width:44px;min-width:44px}
.col-time{width:84px;min-width:84px;text-align:right;white-space:nowrap;overflow:visible;color:#9aa}
.col-lesson{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.table-header .h-saat{order:5;text-align:right}
.table-header .h-sinif{order:3}
.table-header .h-ders{order:4}
.left-gutter{padding-left:2px}


/* === fix30: Anasayfa başlık sırası + kolonlar (saat kesilmesin, sol boşluk az) === */
.tableHeader{
  display:grid !important;
  grid-template-columns: 14px 26px 52px 1fr 112px !important; /* dot, #, sınıf, ders, saat */
  align-items:center !important;
  column-gap: 6px !important;
  padding: 10px 10px 10px 6px !important;
}
.tableHeader > div{ opacity:.85; letter-spacing:.6px; font-weight:800; }
.tableHeader > div:nth-child(2){ text-align:center; } /* # */
.tableHeader > div:nth-child(5){ text-align:right; } /* saat */

.row{
  display:grid !important;
  grid-template-columns: 14px 26px 52px 1fr 112px !important;
  align-items:center !important;
  column-gap: 6px !important;
  padding: 14px 10px 14px 6px !important; /* soldan daha az boşluk */
  overflow: visible !important;
}

.dotBtn{ width: 14px !important; height: 14px !important; }
.dot{ width: 6px !important; height: 6px !important; }

.no{ text-align:center !important; }
.class{ color:#fff !important; opacity:.95 !important; font-weight:800 !important; }
.lesson{ color: var(--orange) !important; font-weight:900 !important; overflow:hidden !important; text-overflow:ellipsis !important; white-space:nowrap !important; }
.time{ text-align:right !important; white-space:nowrap !important; overflow:visible !important; opacity:.75 !important; }

@media (max-width: 420px){
  .tableHeader, .row{
    grid-template-columns: 12px 24px 48px 1fr 104px !important;
    column-gap: 5px !important;
    padding-left: 4px !important;
    padding-right: 8px !important;
  }
  .time{ font-size: calc(12px * var(--uiScale)) !important; }
}



/* FIX115: Gün tablosu saat alanı serbest (HH:MM) */
.planRow .timeInp{
  width: 96px;
  padding: 6px 8px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,.14);
  background: rgba(255,255,255,.06);
  color: inherit;
}
</style>

<style>
/* NOTLAR – tablo altı, sol hizalı (satırlarla birlikte kayar) */
.notesEntry{ justify-content:flex-start; margin-top:10px; margin-left:4px; }
</style>


<style>
/* === Ayar Çarkı: Haftalık butonunun yanına (inline) === */
.modeToggle{ align-items:center; }
.modeToggle .settingsBtn{
  position: static !important;
  inset: auto !important;
  width: 44px;
  height: 44px;
  border-radius: 14px;
  margin-left: 6px;
  flex: 0 0 auto;
}
</style>


<style>
/* === Ayar Çarkı küçültme === */
.modeToggle .settingsBtn{
  width: 34px !important;
  height: 34px !important;
  border-radius: 10px !important;
  font-size: 16px !important;
  margin-left: 6px;
  padding: 0 !important;
}
</style>


<style id="day-mode-fix">
/* === GÜNDÜZ MODU OKUNABİLİRLİK FIX (geceyi bozmaz) === */

/* Başlık: gündüzde beyaz kalmasın */
body.theme-day .appTitle{ color: var(--text) !important; }
body.theme-day .appTitle .accent{ color: var(--orange) !important; }

/* Üst bar: gündüz değişkenlerini kullan */
body.theme-day .topbar{
  background: linear-gradient(to bottom, var(--topbar1), var(--topbar2), var(--topbar3)) !important;
}

/* Günlük tablo yazıları: güvenli şekilde koyulaştır */
body.theme-day .tableCard,
body.theme-day .tableHeader,
body.theme-day .row,
body.theme-day .lesson,
body.theme-day .time,
body.theme-day .muted,
body.theme-day .noteCard{
  color: var(--text) !important;
}
body.theme-day .time,
body.theme-day .hint,
body.theme-day .notesItemMeta,
body.theme-day .settingsHint{
  color: var(--timeText) !important;
}

/* Haftalık tablo (weekGrid) – her tarayıcıda görünürlük */
body.theme-day #weeklyGridWrap,
body.theme-day table.weekGrid,
body.theme-day .weekGrid th,
body.theme-day .weekGrid td,
body.theme-day .wCls,
body.theme-day .wLes,
body.theme-day .tNo,
body.theme-day .tTime{
  color: var(--text) !important;
}
body.theme-day .weekGrid th{
  color: rgba(11,18,32,0.72) !important;
}
body.theme-day .weekGrid td{
  color: rgba(11,18,32,0.92) !important;
}

/* Bazı eski sınıflar (light / light-mode / day-mode) yüzünden çakışma olursa: theme-day üstün gelsin */
body.theme-day .weeklyTable th,
body.theme-day .weeklyTable td,
body.theme-day .weeklyTable td *,
body.theme-day .weeklyTable th *{
  color: rgba(11,18,32,0.92) !important;
}


/* Günlük (gündüz): Sınıf alanı yazısı beyaz kalmasın */
body.theme-day .class{ color: var(--text) !important; }



/* GÜNDÜZ: Ders isimleri turuncu (geceyle aynı vurgu) */
body.theme-day .lesson{
  color: var(--orange) !important;
  font-weight: 1000;
}



/* GÜNDÜZ: NOTLAR butonu dış çizgisi siyah olsun (daha net) */
body.theme-day .notesBtn{
  border-color: rgba(0,0,0,0.55) !important;
  color: rgba(11,18,32,0.95) !important;
}
body.theme-day .notesBtn:active{
  border-color: rgba(0,0,0,0.75) !important;
}

</style>


<style>
/* === GÜNDÜZ/GEC E: Tablo başlık şeridi transparan olmasın, altı görünmesin === */

/* Günlük tablo başlığı */
.tableHeader{
  background: var(--card) !important;      /* opak kart rengi */
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
}

/* Eğer sticky kullanılıyorsa üstten kayarken alttakini göstermesin */
.tableHeader.sticky,
.sticky .tableHeader{
  background: var(--card) !important;
  box-shadow: 0 2px 8px rgba(0,0,0,0.06);
}

/* Gündüz modunda daha açık opak zemin */
body.theme-day .tableHeader{
  background: rgba(245,247,250,1) !important;
}

/* Haftalık başlıklar */
.weekGrid th,
.weekHeader,
.weekHead{
  background: var(--card) !important;
  backdrop-filter: none !important;
}
body.theme-day .weekGrid th,
body.theme-day .weekHeader,
body.theme-day .weekHead{
  background: rgba(245,247,250,1) !important;
}

/* Güvenlik: herhangi bir blur/opacity kalıntısı varsa sıfırla */
.tableHeader, .weekGrid th{
  opacity: 1 !important;
}
</style>


<style>
/* === ÜST ŞERİT ALTINA GİREN YAZILAR GÖRÜNMESİN (GÜNDÜZ+GECE) === */
.topbar{
  background: rgba(11,18,32,1) !important;   /* GECE: opak */
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
  position: sticky;
  z-index: 2000 !important;
}
/* GÜNDÜZ: opak açık zemin */
body.theme-day .topbar{
  background: rgba(245,247,250,1) !important;
}

/* Topbar alt kenarında şeffaflık/gradient kalıntısı varsa kapat */
.topbar{ position: sticky; }
.topbar::after{
  content:"";
  position:absolute;
  left:0; right:0;
  bottom:-18px;
  height:18px;
  background: inherit;
}

/* Başlık satırı (SINIF/DERS/SAAT) yukarı çıkınca topbar altında görünmesin */
.tableHeader{
  z-index: 1500 !important;
}
</style>


<style>
/* === ÜSTTEKİ SİYAH ÇİZGİYİ KALDIR, ALTTAKİ TURUNCU ÇİZGİYİ BELİRGİNLEŞTİR === */

/* Siyah çizgi (border / hr / pseudo) ne varsa kapat */
.topbar, .topbar *{
  border-top: none !important;
  border-bottom: none !important;
}
.topbar::before, .topbar::after{
  box-shadow: none !important;
}

/* Eğer ayrı bir divider varsa kapat */
.divider, .topDivider, .headerDivider{
  display: none !important;
}

/* Gün başlıklarının altındaki turuncu çizgi */
.dayTabs, .daysRow{
  position: relative;
}
.dayTabs::after, .daysRow::after{
  content: "";
  position: absolute;
  left: 12px;
  right: 12px;
  bottom: -8px;
  height: 3px;
  border-radius: 3px;
  background: linear-gradient(90deg, var(--orange), #ff9b33);
  box-shadow: 0 2px 6px rgba(255,122,0,0.45);
}

/* Gündüz modunda daha net görünsün */
body.theme-day .dayTabs::after,
body.theme-day .daysRow::after{
  background: linear-gradient(90deg, var(--orange), #ff8a00);
  box-shadow: 0 2px 8px rgba(255,122,0,0.55);
}
</style>

</head>

<body>


  <div class="app">
    <div class="scrollArea">

      <div class="topbar">
        <div class="appTitle">DERS-<span class="accent">TAKİP</span></div>

        <div class="modeToggle" role="tablist" aria-label="Yayın modu">
          <button class="modeBtn active" id="modeDaily" type="button">GÜNLÜK</button>
          <button class="modeBtn" id="modeWeekly" type="button">HAFTALIK</button>
        
    <button id="btnSettings" class="settingsBtn" type="button" aria-label="Ayarlar" title="Ayarlar">⚙️</button>
</div>

        <div class="dayTabs" id="dayTabs" aria-label="Günler">
          <button class="dayTab active" data-day="0" type="button">Pazartesi</button>
          <button class="dayTab" data-day="1" type="button">Salı</button>
          <button class="dayTab" data-day="2" type="button">Çarşamba</button>
          <button class="dayTab" data-day="3" type="button">Perşembe</button>
          <button class="dayTab" data-day="4" type="button">Cuma</button>
          <button class="dayTab" data-day="5" type="button">Cumartesi</button>
          <button class="dayTab" data-day="6" type="button">Pazar</button>
        </div>
      </div>

      <!-- GÜNLÜK -->
      <div id="dailyWrap">
        <div class="daySwipe" id="daySwipe">
          <div class="dayTrack" id="dayTrack">
            <!-- Sayfalar JS ile doldurulacak -->
          </div>
        </div>


        <div id="dailyFooterTpl" style="display:none;">
<div class="notesEntry">
          <button class="notesBtn" id="notesBtn" type="button" onclick="window.__openNotes && window.__openNotes()">
            NOTLAR <span class="notesDot" id="notesDot"></span>
          </button>
        </div>
<div class="hint">          • Ders satırına <b>basılı tut</b> → ilk not/ödev/sınav girişini açar.<br>
          • Turuncu <b>nokta</b> varsa dokun → kayıtlı bilgi sayfasını açar.
        </div>
</div>
      </div>

      <!-- HAFTALIK (sonraki aşama) -->
      <div class="weeklyWrap" id="weeklyWrap">
        <div id="weeklyGridWrap"></div>
      </div>
        </div>
      </div>

      <div style="height: 120px"></div>
    </div>

    <div class="frame" aria-hidden="true"></div>
  </div>

  <!-- Modal: nokta tıkla / uzun bas -->
  <div class="modalOverlay" id="overlay" aria-hidden="true">
    <div class="sheet" role="dialog" aria-modal="true" aria-label="Ders notu">
      <div class="sheetHeader">
        <div style="min-width:0">
          <div class="sheetTitle" id="sheetTitle">Ders</div>
          <div class="muted" id="sheetSub">—</div>
        </div>
        <div class="pill" id="sheetMode">BİLGİ</div>
      </div>

      <div id="viewPanel">
        <div class="noteCard" style="margin-top:0">
          <div><b>Ödev</b></div>
          <div class="muted" id="vHomework">—</div>
          <div class="hr"></div>
          <div><b>Not</b></div>
          <div class="muted" id="vNote">—</div>
          <div class="hr"></div>
          <div><b>Sınav</b></div>
          <div class="muted" id="vExam">—</div>
        </div>

        <div class="btnRow">
          <button class="btn" id="btnClose" type="button">Kapat</button>
          <button class="btn btnPrimary" id="btnEdit" type="button">Düzenle</button>
        </div>
      </div>

      <div id="editPanel" style="display:none">
        <div class="field">
          <div class="label">ÖDEV</div>
          <textarea id="iHomework" placeholder="Ödev yaz..."></textarea>
        </div>
        <div class="field">
          <div class="label">NOT</div>
          <textarea id="iNote" placeholder="Not yaz..."></textarea>
        </div>
        <div class="field">
          <div class="label">SINAV TARİHİ</div>
          <input id="iExamDate" type="date" />
        </div>
        <div class="field">
          <div class="label">SINAV AÇIKLAMA</div>
          <textarea id="iExamNote" placeholder="Sınav konusu / açıklama..."></textarea>
        </div>

        <div class="btnRow">
          <button class="btn" id="btnCancel" type="button">Vazgeç</button>
          <button class="btn btnPrimary" id="btnSave" type="button">Kaydet</button>
        </div>
        <div class="hint">
          Kayıtlar telefonda saklanır (internet olmasa da çalışır).<br>
          İstersen sonraki aşamada “Yedekle / Geri Yükle” ekleriz.
        </div>
      </div>
    </div>
  </div>



  <!-- NOTLAR -->
  <div class="modalOverlay" id="notesOverlay" aria-hidden="true">
    <div class="sheet" role="dialog" aria-modal="true" aria-label="Notlar">
      <div class="sheetHeader">
        <div class="sheetTitle">NOTLAR</div>
        <button class="btn" id="btnNotesClose" type="button">Kapat</button>
      </div>

      <div class="filters" aria-label="Filtreler">
        <button class="filterBtn active" data-filter="all" type="button">Hepsi</button>
        <button class="filterBtn" data-filter="homework" type="button">Ödev</button>
        <button class="filterBtn" data-filter="note" type="button">Not</button>
        <button class="filterBtn" data-filter="exam" type="button">Sınav</button>
      </div>

      <div id="notesList"></div>
    </div>
  

  <script>
    /***********************
     * OFFLINE KAYIT MANTIĞI
     * - Ders programı (sabit) = JS içinde
     * - Ödev/Not/Sınav (değişken) = localStorage
     ************************/

    // 0=Pzt ... 6=Paz
    const DAYS = ["Pazartesi","Salı","Çarşamba","Perşembe","Cuma","Cumartesi","Pazar"];

    // Demo program (sonraki adımda senin gerçek tablo/verilerine göre dolduracağız)
    const demoTimetable = {
      0: [
        {no:1, time:"08:15-08:55", cls:"12/J", lesson:"KELAM"},
        {no:2, time:"09:05-09:45", cls:"12/J", lesson:"KELAM"},
        {no:3, time:"09:55-10:35", cls:"11/A", lesson:"MESLEKİ ARAPÇA"},
        {no:4, time:"10:45-11:25", cls:"11/A", lesson:"MESLEKİ ARAPÇA"},
        {no:5, time:"12:10-12:50", cls:"12/A", lesson:"KELAM"},
        {no:6, time:"13:00-13:40", cls:"12/A", lesson:"KELAM"},
        {no:7, time:"13:50-14:30", cls:"09/C", lesson:"KURAN-I KERİM"},
        {no:8, time:"14:40-15:20", cls:"09/C", lesson:"KURAN-I KERİM"},
      ],
      1: [{no:1,time:"08:15-08:55",cls:"10/B",lesson:"FIKIH"}],
      2: [{no:1,time:"08:15-08:55",cls:"12/J",lesson:"TEFSİR"}],
      3: [{no:1,time:"08:15-08:55",cls:"11/A",lesson:"HADİS"}],
      4: [{no:1,time:"08:15-08:55",cls:"09/C",lesson:"KURAN-I KERİM"}],
      5: [{no:1,time:"08:15-08:55",cls:"12/A",lesson:"KELAM"}],
      6: [{no:1,time:"08:15-08:55",cls:"10/B",lesson:"SİYER"}],
    };

    // Ayarlar > Günler'de girilen dersleri ana sayfaya bağla
    const KEY_DAYLESSONS = "DTK_dayLessons_v1"; // {0:[{no,cls,lesson,time}], ...}
    function loadTimetableFromSettings(){
      try{
        const raw = localStorage.getItem(KEY_DAYLESSONS);
        if(!raw) return null;
        const obj = JSON.parse(raw);
        if(!obj || typeof obj !== "object") return null;

        const t = {};
        for(let d=0; d<7; d++){
          const arr = Array.isArray(obj[d]) ? obj[d] : [];
          const clean = arr
            .map(x=>({
              no: Number(x.no)||0,
              time: String(x.time||"").trim(),
              cls: String(x.cls||"").trim(),
              lesson: String(x.lesson||"").trim(),
            }))
            .filter(x=>x.no>0 && (x.cls || x.lesson || x.time)); // boş satırları at
          clean.sort((a,b)=>a.no-b.no);
          t[d] = clean;
        }
        // en az bir gün doluysa geçerli say
        const hasAny = Object.values(t).some(a=>Array.isArray(a) && a.length);
        return hasAny ? t : null;
      }catch(e){
        return null;
      }
    }

    let timetable = loadTimetableFromSettings() || demoTimetable;

    // Ana sayfayı anında güncellemek için (web/telefon aynı davranış)
    window.__refreshTimetableFromSettings = function(){
      try{
        timetable = loadTimetableFromSettings() || demoTimetable;
      }catch(e){}
    };



    const STORE_KEY = "ders_takip_notes_v1";

    function loadStore(){
      try{
        const raw = JSON.parse(localStorage.getItem(STORE_KEY) || "{}");
        // Eski anahtarlar: gun|no|sinif|ders -> yeni anahtar: gun|no
        let changed = false;
        for (const k of Object.keys(raw)){
          const parts = String(k).split("|");
          if (parts.length >= 3){
            const nk = parts[0] + "|" + parts[1];
            if (!(nk in raw)) raw[nk] = raw[k];
            delete raw[k];
            changed = true;
          }
        }
        if (changed){
          localStorage.setItem(STORE_KEY, JSON.stringify(raw));
        }
        return raw;
      }catch(e){
        return {};
      }
    }
    function saveStore(data){
      localStorage.setItem(STORE_KEY, JSON.stringify(data));
    }

    // Her satıra stabil bir id üretelim
    function lessonId(dayIndex, row){
      // Notların derse bağlı kimliği: gün + ders no (saat/sınıf/ders değişse de not kaybolmasın)
      return dayIndex + "|" + String(row.no);
    }

    // Bugün hangi gün? (TR: Pazar=0 gelir, biz Pzt=0 istiyoruz)
    function todayIndex(){
      const d = new Date();
      const js = d.getDay(); // 0 Pazar ... 6 Cumartesi
      return (js + 6) % 7;   // 0 Pazartesi ... 6 Pazar
    }

    // ===== Aktif Günler (Ayarlar > Günler) =====
    const KEY_ACTIVE_DAYS = "DTK_activeDays_v1"; // [bool x7] Pazartesi=0
    function getActiveDaysArray(){
      try{
        const a = JSON.parse(localStorage.getItem(KEY_ACTIVE_DAYS) || "null");
        if(Array.isArray(a) && a.length === 7) return a.map(Boolean);
      }catch(e){}
      return [true,true,true,true,true,false,false]; // varsayılan
    }

    function ymd(dateObj){
      const y = dateObj.getFullYear();
      const m = String(dateObj.getMonth()+1).padStart(2,"0");
      const d = String(dateObj.getDate()).padStart(2,"0");
      return `${y}-${m}-${d}`;
    }

    function daysBetween(ymdA, ymdB){
      // ymdA->ymdB (B-A) gün farkı
      const a = new Date(ymdA + "T00:00:00");
      const b = new Date(ymdB + "T00:00:00");
      return Math.round((b - a) / (1000*60*60*24));
    }

    // Nokta kuralı:
    // - Sadece bugünün sayfasında göster.
    // - Kayıt varsa (ödev veya not dolu) => nokta ON
    // - Sınav tarihi bugünden itibaren 0..2 gün içinde => nokta ON
    function shouldShowDot(dayIndex, id, store){
      // SATIR BAŞI TURUNCU NOKTA:
      // - Bu ders için ÖDEV veya NOT varsa: her zaman göster
      // - Sınav tarihi varsa ve 0–2 gün kaldıysa: göster
      const item = store && store[id];
      if(!item) return false;

      const hasHomeworkOrNote =
        (item.homework && String(item.homework).trim()) ||
        (item.note && String(item.note).trim());

      if(hasHomeworkOrNote) return true;

      if(item.examDate){
        const diff = daysBetween(ymd(new Date()), String(item.examDate).trim());
        if(diff !== null && diff >= 0 && diff <= 2) return true;
      }
      return false;
    }

    /***********************
     * UI: Sayfaları oluştur
     ************************/
    const dayTrack = document.getElementById("dayTrack");

    function buildDayPage(dayIndex){
      const rows = timetable[dayIndex] || [];
      const page = document.createElement("section");
      page.className = "dayPage";

      const card = document.createElement("div");
      card.className = "tableCard";

      const header = document.createElement("div");
      header.className = "tableHeader";
      header.innerHTML = `<div></div><div>#</div><div>SINIF</div><div>DERS</div><div>SAAT</div>`;
      card.appendChild(header);

      const store = loadStore();

      rows.forEach(r=>{
        const id = lessonId(dayIndex, r);

        const row = document.createElement("div");
        row.className = "row";
        row.dataset.id = id;
        row.dataset.day = String(dayIndex);

        // Dot button
        const dotBtn = document.createElement("div");
        dotBtn.className = "dotBtn";
        dotBtn.setAttribute("role","button");
        dotBtn.setAttribute("aria-label","Bilgiler");

        const dot = document.createElement("div");
        dot.className = "dot" + (shouldShowDot(dayIndex, id, store) ? " on" : "");
        dotBtn.appendChild(dot);

        // Dot tıklanınca bilgi sayfası
        dotBtn.addEventListener("click", (e)=>{
          e.stopPropagation();
          openView(id, dayIndex, r);
        });

        // Satır uzun bas: ilk giriş
        attachLongPress(row, ()=> openEdit(id, dayIndex, r, true));

        // Satıra normal tık: hiçbir şey (ana sayfa temiz)
        row.addEventListener("click", ()=>{});

        row.innerHTML = `
          <div class="no">${r.no}</div>
          <div class="time">${r.time}</div>
          <div class="class">${r.cls}</div>
          <div class="lesson" title="${escapeHtml((r.lesson||""))}">${escapeHtml((r.lesson||""))}</div>
        `;

        // row grid: dot + no + time + class + lesson şeklinde kurmak için
        // row.innerHTML yukarıda dot yok; onu başa ekleyelim:
        // (grid kolonlarına uyması için çocukları yeniden düzenleyelim)
        const noEl = row.children[0];
        const timeEl = row.children[1];
        const clsEl = row.children[2];
        const lesEl = row.children[3];

        row.innerHTML = "";
        row.appendChild(dotBtn);
        row.appendChild(noEl);
        row.appendChild(clsEl);
        row.appendChild(lesEl);
        row.appendChild(timeEl);

        card.appendChild(row);
      });

      page.appendChild(card);

      // NOTLAR + küçük yardım yazıları: tablo altına ekle (satırlarla birlikte kayar)
      const ft = document.getElementById("dailyFooterTpl");
      if(ft){
        const clone = ft.cloneNode(true);
        clone.removeAttribute("id");
        clone.style.display = "";
        page.appendChild(clone);
      }

      return page;
    }

    function renderAllPages(){
      dayTrack.innerHTML = "";
      for(let d=0; d<7; d++){
        dayTrack.appendChild(buildDayPage(d));
      }
    }

    // dışarıdan tetiklemek için
    window.addEventListener('dtk:settings-updated', function(){
      try{ timetable = loadTimetableFromSettings() || demoTimetable; }catch(e){}
      try{ renderAllPages(); refreshDots(); }catch(e){}
      try{ if(typeof window.renderWeeklyGrid==='function') window.renderWeeklyGrid(); }catch(e){}
    });

    window.renderDailyPages = function(){
      try{ timetable = loadTimetableFromSettings() || demoTimetable; }catch(e){}
      try{ renderAllPages(); refreshDots(); }catch(e){}
    };

    function refreshDots(){
      // SADECE NOKTALARI GÜNCELLE (linkleri etkileme)
      let store = {};
      try{ store = loadStore(); }catch(e){ store = {}; }

      // 1) Herhangi bir günde kaydı olan dersler
      const lessonsWithRecord = new Set();
      try{
        Object.keys(store||{}).forEach(id=>{
          const it = store[id];
          if(!it) return;
          const hasText = (it.homework && String(it.homework).trim()) || (it.note && String(it.note).trim());
          const hasExam = it.examDate && String(it.examDate).trim();
          const lesson = it.meta && it.meta.lesson ? String(it.meta.lesson).trim() : "";
          if(lesson && (hasText || hasExam)) lessonsWithRecord.add(lesson);
        });
      }catch(e){}

      // 2) Bu sayfadaki her ders için "o günün ilk dersi" numarası
      const firstNoByLesson = {};
      try{
        document.querySelectorAll(".row").forEach(row=>{
          const lessonEl = row.querySelector(".lesson");
          const noEl = row.querySelector(".no");
          if(!lessonEl || !noEl) return;
          const lesson = String(lessonEl.textContent||"").trim();
          const no = parseInt(String(noEl.textContent||"").trim(), 10);
          if(!lesson || !Number.isFinite(no)) return;
          if(firstNoByLesson[lesson]==null || no < firstNoByLesson[lesson]) firstNoByLesson[lesson]=no;
        });
      }catch(e){}

      // 3) Noktaları yak
      try{
        document.querySelectorAll(".row").forEach(row=>{
          const id = row.dataset ? row.dataset.id : null;
          const day = row.dataset ? Number(row.dataset.day) : NaN;
          const dot = row.querySelector(".dot");
          if(!dot || !id) return;

          const own = shouldShowDot(day, id, store);
          if(own){
            dot.classList.add("on");
            return;
          }

          const lessonEl = row.querySelector(".lesson");
          const noEl = row.querySelector(".no");
          const lesson = lessonEl ? String(lessonEl.textContent||"").trim() : "";
          const no = noEl ? parseInt(String(noEl.textContent||"").trim(), 10) : NaN;

          const cross = lesson && Number.isFinite(no) && firstNoByLesson[lesson] === no && lessonsWithRecord.has(lesson);
          dot.classList.toggle("on", !!cross);
        });
      }catch(e){}
    }

    /***********************
     * NOTLAR (liste + filtre)
     ************************/
    const notesBtn = document.getElementById("notesBtn");
    const notesDot = document.getElementById("notesDot");
    const notesOverlay = document.getElementById("notesOverlay");
    const notesList = document.getElementById("notesList");
    const btnNotesClose = document.getElementById("btnNotesClose");
    const filterBtns = [...document.querySelectorAll("#notesOverlay .filterBtn")];

    let activeFilter = "all";

    function hasAnyNotes(){
      const store = loadStore();
      return Object.values(store).some(item =>
        (item.homework && item.homework.trim()) ||
        (item.note && item.note.trim()) ||
        (item.examDate && item.examDate.trim())
      );
    }

    function refreshNotesDot(){
      if(!notesDot) return;
      notesDot.classList.toggle("on", hasAnyNotes());
    }

    function entryMatchesFilter(item, filter){
      const hasHomework = item.homework && item.homework.trim();
      const hasNote = item.note && item.note.trim();
      const hasExam = item.examDate && item.examDate.trim();
      if(filter === "homework") return !!hasHomework;
      if(filter === "note") return !!hasNote;
      if(filter === "exam") return !!hasExam;
      return !!(hasHomework || hasNote || hasExam); // all
    }

    function setActiveFilter(filter){
      activeFilter = filter;
      filterBtns.forEach(b => b.classList.toggle("active", b.dataset.filter === filter));
      renderNotesList();
    }

    function safeMeta(item){
      const meta = item.meta || {};
      return {
        dayIndex: (typeof meta.dayIndex === "number") ? meta.dayIndex : null,
        no: meta.no || "",
        time: meta.time || "",
        cls: meta.cls || "",
        lesson: meta.lesson || ""
      };
    }

    function renderNotesList(){
      if(!notesList) return;
      notesList.innerHTML = "";
      const store = loadStore();

      const entries = Object.entries(store)
        .map(([id,item]) => ({id, item}))
        .filter(({item}) => entryMatchesFilter(item, activeFilter))
        .sort((a,b)=> (b.item.updatedAt||0) - (a.item.updatedAt||0));

      if(entries.length === 0){
        notesList.innerHTML = '<div class="muted">Bu filtrede kayıt yok.</div>';
        return;
      }

      entries.forEach(({id,item})=>{
        const meta = safeMeta(item);
        const title = meta.lesson ? meta.lesson : (meta.cls ? meta.cls : "Kayıt");
        const dayText = (meta.dayIndex !== null) ? DAYS[meta.dayIndex] : "—";
        const line1 = `${dayText}${meta.time ? " • "+meta.time : ""}${meta.cls ? " • "+meta.cls : ""}${meta.no ? " • "+meta.no+". Ders" : ""}`;

        const parts = [];
        if(item.homework && item.homework.trim()) parts.push("Ödev");
        if(item.note && item.note.trim()) parts.push("Not");
        if(item.examDate && item.examDate.trim()) parts.push("Sınav: " + item.examDate);
        const line2 = parts.join(" • ");

        const div = document.createElement("div");
        div.className = "noteCard";
        div.style.cursor = "pointer";
        div.innerHTML = `
          <div class="notesItemTitle">${escapeHtml(title)}</div>
          <div class="notesItemMeta">${escapeHtml(line1)}</div>
          <div class="notesItemMeta">${escapeHtml(line2 || "—")}</div>
        `;

        div.addEventListener("click", ()=>{
          // Notlar ekranından ilgili kaydı aç:
          // meta varsa doğru satır başlığıyla açarız.
          const r = { no: meta.no || "", time: meta.time || "", cls: meta.cls || "", lesson: meta.lesson || title };
          const dIdx = (meta.dayIndex !== null) ? meta.dayIndex : todayIndex();
          openEdit(id, dIdx, r, false);
          closeNotes();
        });

        notesList.appendChild(div);
      });
    }

    function openNotes(){
      renderNotesList();
      notesOverlay.classList.add("show");
      notesOverlay.setAttribute("aria-hidden","false");
    }
    window.__openNotes = openNotes;

    function closeNotes(){
      notesOverlay.classList.remove("show");
      notesOverlay.setAttribute("aria-hidden","true");
    }

    if(notesBtn){
      notesBtn.addEventListener("click", openNotes);
    }

    // Android/WebView bazı durumlarda buton click'i yutabiliyor: garanti yakalama
    document.addEventListener("click", (e)=>{
      const t = e.target;
      if(!t) return;
      const btn = t.closest ? t.closest("#notesBtn, .notesEntry") : null;
      if(btn){
        // üstteki event'lerle çakışmasın
        e.preventDefault();
        openNotes();
      }
    }, true);

    const notesEntryEl = document.querySelector(".notesEntry");
    if(notesEntryEl){
      notesEntryEl.addEventListener("click", openNotes);
    }
    if(btnNotesClose){
      btnNotesClose.addEventListener("click", closeNotes);
    }
    if(notesOverlay){
      notesOverlay.addEventListener("click", (e)=>{
        if(e.target === notesOverlay) closeNotes();
      });
    }

    // NOTLAR paneli: aşağı kaydırarak kapatma
    let notesSwipeStartY = null;
    let notesSwipeStartX = null;
    let notesSwipeActive = false;

    function notesTouchStart(ev){
      const t = ev.touches[0];
      notesSwipeStartY = t.clientY;
      notesSwipeStartX = t.clientX;
      notesSwipeActive = true;
    }
    function notesTouchMove(ev){
      if(!notesSwipeActive) return;
      const t = ev.touches[0];
      const dy = t.clientY - notesSwipeStartY;
      const dx = Math.abs(t.clientX - notesSwipeStartX);
      // sadece dikey aşağı sürükleme
      if(dy > 80 && dx < 40){
        notesSwipeActive = false;
        closeNotes();
      }
    }
    function notesTouchEnd(){
      notesSwipeActive = false;
      notesSwipeStartY = null;
      notesSwipeStartX = null;
    }

    if(notesOverlay){
      const notesSheet = notesOverlay.querySelector(".sheet");
      if(notesSheet){
        notesSheet.addEventListener("touchstart", notesTouchStart, {passive:true});
        notesSheet.addEventListener("touchmove", notesTouchMove, {passive:true});
        notesSheet.addEventListener("touchend", notesTouchEnd, {passive:true});
      }
    }

    filterBtns.forEach(b => b.addEventListener("click", ()=> setActiveFilter(b.dataset.filter)));


    /***********************
     * Gün sekmesi + swipe
     ************************/
    const dayTabs = [...document.querySelectorAll(".dayTab")];
    const daySwipe = document.getElementById("daySwipe");
    let activeDay = 0;

    function setActiveDay(index, dirHint=0){
      const active = getActiveDaysArray();

      let i = (index + 7) % 7;
      if(!active[i]){
        if(dirHint === 0) dirHint = 1;
        let tries = 0;
        let j = i;
        while(tries < 7 && !active[j]){
          j = (j + dirHint + 7) % 7;
          tries++;
        }
        i = j;
      }
      activeDay = i;

      // sekmelerde sadece aktif günleri göster
      dayTabs.forEach(b=>{
        const d = Number(b.dataset.day);
        b.style.display = active[d] ? "" : "none";
      });

      dayTabs.forEach(b => b.classList.remove("active"));
      const btn = dayTabs.find(b => Number(b.dataset.day) === activeDay);
      if(btn){
        btn.classList.add("active");
        btn.scrollIntoView({behavior:"smooth", inline:"center", block:"nearest"});
      }

      dayTrack.style.transform = `translateX(-${activeDay * (100/7)}%)`;
      // nokta kural
      refreshDots();
      refreshNotesDot();
    }

    dayTabs.forEach(btn=>{
      btn.addEventListener("click", ()=> setActiveDay(Number(btn.dataset.day)));
    });

    // Swipe
    let startX = 0, curX = 0, dragging = false;
    daySwipe.addEventListener("touchstart", (e)=>{
      dragging = true;
      startX = e.touches[0].clientX;
      curX = startX;
    }, {passive:true});

    daySwipe.addEventListener("touchmove", (e)=>{
      if(!dragging) return;
      curX = e.touches[0].clientX;
    }, {passive:true});

    daySwipe.addEventListener("touchend", ()=>{
      if(!dragging) return;
      dragging = false;
      const dx = curX - startX;
      if(dx < -40) setActiveDay(activeDay + 1, 1);
      else if(dx > 40) setActiveDay(activeDay - 1, -1);
    });

    /***********************
     * Mod toggle (haftalık sonra)
     ************************/
    const modeDaily = document.getElementById("modeDaily");
    const modeWeekly = document.getElementById("modeWeekly");
    const dailyWrap = document.getElementById("dailyWrap");
    const weeklyWrap = document.getElementById("weeklyWrap");

    function setMode(mode){
      const dayTabsEl = document.getElementById("dayTabs");
      const isDaily = (mode === "daily");
      modeDaily.classList.toggle("active", isDaily);
      modeWeekly.classList.toggle("active", !isDaily);
      dailyWrap.style.display = isDaily ? "block" : "none";
      if(dayTabsEl) dayTabsEl.style.display = isDaily ? "flex" : "none";
      weeklyWrap.style.display = isDaily ? "none" : "block";
      if(!isDaily && typeof window.renderWeeklyGrid === "function") window.renderWeeklyGrid();
    }
    modeDaily.addEventListener("click", ()=> setMode("daily"));
    modeWeekly.addEventListener("click", ()=> setMode("weekly"));

    /***********************
     * Modal: görüntüleme / düzenleme
     ************************/
    const overlay = document.getElementById("overlay");
    const sheetTitle = document.getElementById("sheetTitle");
    const sheetSub = document.getElementById("sheetSub");
    const sheetMode = document.getElementById("sheetMode");

    const viewPanel = document.getElementById("viewPanel");
    const editPanel = document.getElementById("editPanel");

    const vHomework = document.getElementById("vHomework");
    const vNote = document.getElementById("vNote");
    const vExam = document.getElementById("vExam");

    const iHomework = document.getElementById("iHomework");
    const iNote = document.getElementById("iNote");
    const iExamDate = document.getElementById("iExamDate");
    const iExamNote = document.getElementById("iExamNote");

    let currentId = null;
    let currentMeta = null; // dayIndex,row

    function openOverlay(){
      overlay.classList.add("show");
      overlay.setAttribute("aria-hidden","false");
    }
    function closeOverlay(){
      overlay.classList.remove("show");
      overlay.setAttribute("aria-hidden","true");
      currentId = null;
      currentMeta = null;
    }
    overlay.addEventListener("click", (e)=>{
      if(e.target === overlay) closeOverlay();
    });

    document.getElementById("btnClose").addEventListener("click", closeOverlay);

    document.getElementById("btnEdit").addEventListener("click", ()=>{
      if(!currentId || !currentMeta) return;
      openEdit(currentId, currentMeta.dayIndex, currentMeta.row, false);
    });

    document.getElementById("btnCancel").addEventListener("click", ()=>{
      // görüntülemeye dön
      if(!currentId || !currentMeta) return;
      openView(currentId, currentMeta.dayIndex, currentMeta.row);
    });

    document.getElementById("btnSave").addEventListener("click", ()=>{
      if(!currentId) return;
      const store = loadStore();
      store[currentId] = {
        homework: iHomework.value || "",
        note: iNote.value || "",
        examDate: iExamDate.value || "",
        examNote: iExamNote.value || "",
        updatedAt: Date.now(),
        meta: {
          dayIndex: currentMeta ? currentMeta.dayIndex : null,
          no: currentMeta ? currentMeta.row.no : null,
          time: currentMeta ? currentMeta.row.time : "",
          cls: currentMeta ? currentMeta.row.cls : "",
          lesson: currentMeta ? currentMeta.row.lesson : ""
        }
      };
      saveStore(store);
      refreshDots();
      refreshNotesDot();
      // kaydettikten sonra görüntüleme
      if(currentMeta) openView(currentId, currentMeta.dayIndex, currentMeta.row);
    });

    function setSheetHeader(dayIndex, row){
      sheetTitle.textContent = row.lesson;
      sheetSub.textContent = `${DAYS[dayIndex]} • ${row.time} • ${row.cls} • ${row.no}. Ders`;
    }

    function openView(id, dayIndex, row){
      const store = loadStore();
      const item = store[id] || null;

      currentId = id;
      currentMeta = {dayIndex, row};

      setSheetHeader(dayIndex, row);
      sheetMode.textContent = "BİLGİ";

      viewPanel.style.display = "block";
      editPanel.style.display = "none";

      vHomework.textContent = (item && item.homework && item.homework.trim()) ? item.homework : "—";
      vNote.textContent = (item && item.note && item.note.trim()) ? item.note : "—";

      if(item && item.examDate){
        const diff = daysBetween(ymd(new Date()), item.examDate);
        const near = (diff >= 0 && diff <= 2) ? ` (⚠️ ${diff} gün kaldı)` : "";
        const extra = (item.examNote && item.examNote.trim()) ? ` • ${item.examNote}` : "";
        vExam.textContent = `${item.examDate}${near}${extra}`;
      }else{
        vExam.textContent = "—";
      }

      openOverlay();
    }

    function openEdit(id, dayIndex, row, isFirstFromLongPress){
      const store = loadStore();
      const item = store[id] || {homework:"", note:"", examDate:"", examNote:""};

      currentId = id;
      currentMeta = {dayIndex, row};

      setSheetHeader(dayIndex, row);
      sheetMode.textContent = ((item.homework && item.homework.trim()) || (item.note && item.note.trim()) || (item.examDate && item.examDate.trim()) || (item.examNote && item.examNote.trim())) ? "DÜZENLE" : "GİRİŞ";

      viewPanel.style.display = "none";
      editPanel.style.display = "block";

      iHomework.value = item.homework || "";
      iNote.value = item.note || "";
      iExamDate.value = item.examDate || "";
      iExamNote.value = item.examNote || "";

      openOverlay();

      if(isFirstFromLongPress){
        // ilk girişte imleç ödev alanına gelsin
        setTimeout(()=> iHomework.focus(), 50);
      }
    }

    /***********************
     * Uzun bas (550ms)
     ************************/
    function attachLongPress(el, onLongPress){
      let timer = null;
      let moved = false;

      const start = (x,y)=>{
        moved = false;
        clearTimeout(timer);
        timer = setTimeout(()=>{
          timer = null;
          if(!moved) onLongPress();
        }, 550);
      };

      const cancel = ()=>{
        clearTimeout(timer);
        timer = null;
      };

      el.addEventListener("touchstart", (e)=>{
        const t = e.touches[0];
        start(t.clientX, t.clientY);
      }, {passive:true});

      el.addEventListener("touchmove", ()=>{
        moved = true;
        cancel();
      }, {passive:true});

      el.addEventListener("touchend", cancel, {passive:true});
      el.addEventListener("touchcancel", cancel, {passive:true});

      // Mouse (PC denemeleri için)
      el.addEventListener("mousedown", ()=> start(0,0));
      el.addEventListener("mouseup", cancel);
      el.addEventListener("mouseleave", cancel);
    }

    function escapeHtml(s){
      return String(s)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    /***********************
     * Başlat
     ************************/
    renderAllPages();

    // Varsayılan: bugünün günü açılsın (istersen 0 sabit de yaparız)
    const tIdx = todayIndex();
    setActiveDay(tIdx);

    setMode("daily");
    refreshDots();

    /***********************
     * İnternet yokken çalışma notu
     * - Bu tek HTML dosyası localStorage ile offline çalışır.
     * - İnternete yayınlamak istersen PWA/Service Worker ekleyebiliriz (sonraki adım).
     ************************/
  
    /***********************
     * HAFTALIK TABLO (bağımsız)
     * - Günlükle ilişki yok
     * - Notlarla ilişki yok
     * - Tıklama yok (sadece görünüm)
     ************************/
    
    function shortLessonName(name, maxLen=12){
      const raw = String(name || "").trim();
      if(!raw) return "";

      // Normalize: Turkish uppercase + remove punctuation/apostrophes for robust matching
      const up = raw
        .toLocaleUpperCase('tr-TR')
        .replace(/[’'`]/g, "")          // apostrophes
        .replace(/[^0-9A-ZĞÜŞİÖÇ\s]/g, " ") // other punctuation -> space
        .replace(/\s+/g, " ")
        .trim();

      // Common abbreviations (you can extend anytime)
      const MAP = {
        "KURAN I KERİM":"KURAN",
        "KURAN I KERIM":"KURAN",
        "MESLEKİ ARAPÇA":"MSARP",
        "MESLEKI ARAPCA":"MSARP",
        "İSLAM KÜLTÜR VE MEDENİYETİ":"İKVM",
        "ISLAM KULTUR VE MEDENIYETI":"İKVM",
        "TEMEL DİNİ BİLGİLER":"TDB",
        "TEMEL DINI BILGILER":"TDB",
        "FIKIH":"FIKIH",
        "TEFSİR":"TEFS",
        "TEFSIR":"TEFS",
        "SİYER":"SİYR",
        "SIYER":"SİYR",
        "KELAM":"KELAM",
        "NÖBET":"NÖBT",
        "NOBET":"NÖBT"
      };

      if(MAP[up]) return MAP[up];

      // Fallback: build initials (up to 4) for multi-word names, otherwise trim by length
      const parts = up.split(" ").filter(Boolean);
      if(parts.length >= 2){
        const initials = parts.map(p => p[0]).join("").slice(0, 4);
        return initials || raw.slice(0, maxLen);
      }

      // Single word: trim to maxLen (no ellipsis in compact views)
      return raw.length <= maxLen ? raw : raw.slice(0, maxLen);
    }

    
    function shortDayName(name){
      const MAP = {
        "PAZARTESİ":"PZT",
        "PAZARTESI":"PZT",
        "SALI":"SAL",
        "ÇARŞAMBA":"ÇAR",
        "CARSAMBA":"ÇAR",
        "PERŞEMBE":"PER",
        "PERSEMBE":"PER",
        "CUMA":"CUM",
        "CUMARTESİ":"CMT",
        "CUMARTESI":"CMT",
        "PAZAR":"PAZ"
      };
      const up = String(name||"").toUpperCase();
      return MAP[up] || name;
    }

    window.renderWeeklyGrid = function(){
      // Haftalık görünüm için ders adı kısaltma (güvenli)
      function __shortLessonWeekly(name){
        const s = String(name||"").trim();
        if(!s) return "";
        const parts = s.split(/\s+/).filter(Boolean);
        if(parts.length >= 2){
          return parts.map(p=>p[0].toUpperCase()).join("").slice(0,4);
        }
        return s.length > 6 ? (s.slice(0,6) + "…") : s;
      }

      try{ timetable = loadTimetableFromSettings() || demoTimetable; }catch(e){}

      const active = getActiveDaysArray();
      const wrap = document.getElementById("weeklyGridWrap");
      if(!wrap) return;
      wrap.innerHTML = "";

      // en fazla kaç ders var?
      let maxLessons = 0;
      for(let d=0; d<7; d++){
        if(!active[d]) continue;
        const rows = timetable[d] || [];
        if(rows.length > maxLessons) maxLessons = rows.length;
      }
      if(maxLessons === 0){
        wrap.innerHTML = '<div class="noteCard" style="margin:12px"><b>Haftalık</b><div class="muted">Gösterilecek ders yok.</div></div>';
        return;
      }

      const table = document.createElement("table");
      table.className = "weekGrid";

      const thead = document.createElement("thead");
      const hr = document.createElement("tr");

      const corner = document.createElement("th");
      corner.className = "stickyTop stickyLeft corner";
      corner.textContent = "Gün";
      hr.appendChild(corner);

      for(let i=0; i<maxLessons; i++){
        // zamanı ilk bulunan günden al
        let time = "";
        for(let d=0; d<7; d++){
          if(!active[d]) continue;
          const r = (timetable[d]||[])[i];
          if(r && r.time){ time = r.time; break; }
        }
        const th = document.createElement("th");
        th.className = "stickyTop";
        const t = (time || "").split("-");
        th.innerHTML = `<div class="tNo">#${i+1}</div><div class="tTime">${escapeHtml(t[0]||"")}</div><div class="tTime">${escapeHtml(t[1]||"")}</div>`;
        hr.appendChild(th);
      }

      thead.appendChild(hr);
      table.appendChild(thead);

      const tbody = document.createElement("tbody");
      for(let d=0; d<7; d++){
        if(!active[d]) continue;
        const rows = timetable[d] || [];
        if(rows.length === 0) continue;

        const tr = document.createElement("tr");

        const dayTh = document.createElement("th");
        dayTh.className = "stickyLeft";
        dayTh.textContent = shortDayName(DAYS[d] || ("Gün " + (d+1)));
        tr.appendChild(dayTh);

        for(let i=0; i<maxLessons; i++){
          const td = document.createElement("td");
          td.className = "wCell";
          const r = rows[i];

          if(r){
            const cls = r.cls || "";
            const les = shortLessonName(r.lesson || "");
            td.innerHTML = `<span class="wCls">${escapeHtml(cls)}</span><span class="wLes">${escapeHtml(les)}</span>`;
          }else{
            td.innerHTML = '<span style="opacity:.18;">-</span>';
          }
          tr.appendChild(td);
        }

        tbody.appendChild(tr);
      }

      table.appendChild(tbody);
      wrap.appendChild(table);
    };


  // ===== Gündüz / Gece Modu =====
  (function(){
    const KEY = "DTK_theme_v1"; // "day" | "night"
    const btnDay = document.getElementById("btnModeDay");
    const btnNight = document.getElementById("btnModeNight");

    function apply(mode){
      const m = (mode === "day") ? "day" : "night";
      document.body.classList.toggle("theme-day", m === "day");
      document.body.classList.toggle("theme-night", m === "night"); // gece modunda :root değerleri kullanılır

      if(btnDay && btnNight){
        btnDay.classList.toggle("active", m === "day");
        btnNight.classList.toggle("active", m === "night");
      }
      try{ localStorage.setItem(KEY, m); }catch(e){}
    }

    // load
    let saved = "night";
    try{
      const v = localStorage.getItem(KEY);
      if(v === "day" || v === "night") saved = v;
    }catch(e){}
    apply(saved);

    if(btnDay){
      btnDay.addEventListener("click", ()=>apply("day"));
      btnDay.addEventListener("touchstart", (e)=>{ e.preventDefault(); apply("day"); }, {passive:false});
    }
    if(btnNight){
      btnNight.addEventListener("click", ()=>apply("night"));
      btnNight.addEventListener("touchstart", (e)=>{ e.preventDefault(); apply("night"); }, {passive:false});
    }
  })();

</script>
</div>


<!-- AYARLAR -->
<div class="overlay" id="settingsOverlay" aria-hidden="true">
  <div class="backdrop" id="settingsBackdrop"></div>
  <div class="panel" role="dialog" aria-modal="true" aria-label="Ayarlar">
    <div class="top">
      <div class="ttl">AYARLAR</div>
      <div class="topActions">
        <button class="miniBtn primary" id="btnSaveSettingsTop" type="button">Kaydet</button>
        <button class="miniBtn" id="btnCloseSettings" type="button">Kapat</button>
      </div>
    </div>
    <div class="body">
      <div class="rowInline rowAlign">
  <div class="inlineGroup">
    <span class="small">Tema</span>
    <button class="miniBtn" id="btnNight" type="button">Gece</button>
    <button class="miniBtn" id="btnDay" type="button">Gündüz</button>

    <span class="small" style="margin-left:12px">Yazı</span>
    <select id="fontSizeSelect" class="miniSelect">
      <option value="small">Küçük</option>
      <option value="medium" selected>Orta</option>
      <option value="large">Büyük</option>
      <option value="xlarge">Çok Büyük</option>
    </select>
  </div>
</div>

<hr class="soft"/>

      <!-- İLK ADIM: Zaman Tablosu -->
      <div>
        <div class="sectionTitle">Zaman Tablosu</div>
        <div class="timeGrid">
          <div class="timeCell">
            <label>Başlangıç Saati</label>
            <input type="time" id="startTimeInp"/>
          </div>
          <div class="timeCell">
            <label>Teneffüs</label>
            <div class="inlineInput">
              <input type="number" id="breakInp" min="0"/>
              <span>dk</span>
            </div>
          </div>
          <div class="timeCell">
            <label>Öğlen Arası</label>
            <div class="inlineInput">
              <input type="number" id="lunchInp" min="0"/>
              <span>dk</span>
            </div>
          </div>
          <div class="timeCell">
            <label>Öğleden Sonra Ders No</label>
            <input type="number" id="afterNoInp" min="1"/>
          </div>
        </div>
      </div>

      <hr class="soft"/>

      <!-- SINIF + DERS TABLOSU -->
      <div>
        <div class="sectionTitle">Sınıf / Ders Tablosu</div>

        
        <div class="pairRow3">
          <div class="pairCell">
            <label>Sınıf / Şube</label>
            <input id="clsInp" type="text" placeholder="12/J" />
          </div>
          <div class="pairCell">
            <label>Ders Adı</label>
            <input id="lesInp" type="text" placeholder="KELAM" />
          </div>
          <div class="pairCell pairBtnCell">
            <label>&nbsp;</label>
            <button class="miniBtn" id="btnAddPair" type="button">Ekle</button>
          </div>
        </div>

        <div class="muteline" style="margin-top:10px">Örn: 12/J + KELAM</div>


        <div class="pairTableWrap">
          <table class="pairTable" id="pairTable" aria-label="Sınıf Ders Tablosu">
            <thead>
              <tr>
                <th style="width:42%">Sınıf/Şube</th>
                <th>Ders</th>
                <th style="width:72px"></th>
              </tr>
            </thead>
            <tbody id="pairTbody"></tbody>
          </table>
        </div>
      </div>

      
      <hr class="soft"/>

      <!-- AKTİF GÜNLER -->
      <div>
        <div class="sectionTitle">Aktif Günler</div>

        <div class="settingsCard" style="margin-top:10px">
          <div id="activeDaysGrid" class="activeDaysGrid" aria-label="Aktif günler"></div>
          <div class="small muted" style="margin-top:10px">
            Kapalı günler üstteki gün barında görünmez ve kaydırarak (swipe) geçişte atlanır.
          </div>
        </div>
      </div>


      <hr class="soft"/>

      <!-- GÜN PROGRAMI: seçilen gün + ders sayısı + ders girişleri -->
      <div>
        <div class="sectionTitle">Gün Programı</div>

        <div class="rowInline gunPlanTop" style="margin-bottom:10px">
          <span class="small">Gün</span>
          <select id="dayPlanSelect" class="miniSelect dayNarrow">
            <option value="0">Pazartesi</option>
            <option value="1">Salı</option>
            <option value="2">Çarşamba</option>
            <option value="3">Perşembe</option>
            <option value="4">Cuma</option>
            <option value="5">Cumartesi</option>
            <option value="6">Pazar</option>
          </select>

          <span class="small" style="margin-left:6px">Ders Sayısı</span>
          <select id="lessonCountSelect" class="miniSelect tinySelect"><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8" selected>8</option><option value="9">9</option><option value="10">10</option></select>
        </div>

        <div class="planTableWrap">
          <div class="planHead">
            <div>#</div>
            <div>Zaman</div>
            <div>Sınıf/Şube</div>
            <div>Ders</div>
          </div>
          <div id="planRows"></div>
        </div>

        <div class="muteline" style="margin-top:8px">
          Not: Değişiklikler otomatik kaydedilir.
        </div>
      </div>

      <!-- Diğer bölümler için sonra devam edeceğiz -->
    </div>
  </div>
</div>





















<div id="toast" class="toast" aria-live="polite" aria-atomic="true"></div>

<script>
  // ===== Toast helper =====
  (function(){
    const el = document.getElementById("toast");
    let t = null;
    window.showToast = function(msg="Kaydedildi"){
      if(!el) return;
      el.textContent = msg;
      el.classList.add("show");
      if(t) clearTimeout(t);
      t = setTimeout(()=>{ el.classList.remove("show"); }, 900);
    };
  })();
</script>

<script id="settings-new-js">

(function(){
  const DAYS = ["Pazartesi","Salı","Çarşamba","Perşembe","Cuma","Cumartesi","Pazar"];

  const KEY_THEME = "DTK_theme_v1";            // "day" | "night"
  const KEY_TEXTSIZE = "DTK_textSize_v1";      // "small" | "medium" | "large"
  const KEY_HOURS = "DTK_hours_v1";            // {start, breakMin, lunchMin, afterNo}
  const LESSON_MIN = 40; // ders süresi (dk)
  const KEY_PAIRS = "DTK_classLessonPairs_v1"; // [{cls, lesson}]
  const KEY_ACTIVE_DAYS = "DTK_activeDays_v1"; // [bool x7] Pazartesi=0
  const KEY_DAYLESSONS = "DTK_dayLessons_v1";  // {0:[{no,time,cls,lesson}], ...}

  const $ = (id)=>document.getElementById(id);

  function loadJSON(key, fallback){
    try{
      const raw = localStorage.getItem(key);
      if(!raw) return fallback;
      return JSON.parse(raw);
    }catch(e){ return fallback; }
  }
  function saveJSON(key, value){
    try{ localStorage.setItem(key, JSON.stringify(value)); }catch(e){}
  }

  function applyTheme(t){
    const day = (t === "day");
    document.body.classList.toggle("theme-day", day);
    document.body.classList.toggle("theme-night", !day);
    try{ localStorage.setItem(KEY_THEME, day ? "day" : "night"); }catch(e){}
    const btnDay = $("btnDay");
    const btnNight = $("btnNight");
    if(btnDay) btnDay.classList.toggle("active", day);
    if(btnNight) btnNight.classList.toggle("active", !day);
  }

  function applyTextSize(size){
    const ok = ["small","medium","large","xlarge"];
    const s = ok.includes(size) ? size : "medium";
    document.body.classList.remove("text-small","text-medium","text-large","text-xlarge");
    document.body.classList.add("text-"+s);
    try{ localStorage.setItem(KEY_TEXTSIZE, s); }catch(e){}
    const sel = $("fontSizeSelect");
    if(sel) sel.value = s;
  }function openSettings(){
    const ov = $("settingsOverlay");
    if(!ov) return;
    ov.classList.add("open");
    ov.setAttribute("aria-hidden","false");
    // mobilde arka plan scroll'u azalt
    document.documentElement.style.overflow = "hidden";
    document.body.style.overflow = "hidden";
    try{ const countSel = $("lessonCountSelect"); if(countSel && (countSel.value==="0" || !countSel.value)) countSel.value="8"; }catch(e){}

    // Gün Programı tablosunu her açılışta aktif tut
    try{
      const daySel = $("dayPlanSelect");
      const countSel = $("lessonCountSelect");
      if(daySel && countSel){
        const d = Number(daySel.value)||0;
        const existing = Array.isArray(dayLessons[d]) ? dayLessons[d].length : 0;
        if(existing===0 && (countSel.value==="0" || !countSel.value)) countSel.value = "8";
        // init edilmediyse et, edildiyse sadece çiz
        initPlanEditor();
        renderPlanRows();
      }
    }catch(e){}
  }
  function closeSettings(){
    const ov = $("settingsOverlay");
    if(!ov) return;
    ov.classList.remove("open");
    ov.setAttribute("aria-hidden","true");
    document.documentElement.style.overflow = "";
    document.body.style.overflow = "";
  }

  // --- Model ---
  let timeCfg = loadJSON(KEY_HOURS, null);
  if(!timeCfg || typeof timeCfg !== "object"){
    timeCfg = { start:"08:15", breakMin:10, lunchMin:40, afterNo:5 };
  }

  let pairs = loadJSON(KEY_PAIRS, []);
  if(!Array.isArray(pairs)) pairs = [];

  let activeDays = loadJSON(KEY_ACTIVE_DAYS, null);
  if(!Array.isArray(activeDays) || activeDays.length !== 7){
    activeDays = [true,true,true,true,true,false,false];
  }

  let planEditorInited = false;
  let dayLessons = loadJSON(KEY_DAYLESSONS, {});
  if(!dayLessons || typeof dayLessons !== "object") dayLessons = {};
  for(let d=0; d<7; d++){
    if(!Array.isArray(dayLessons[d])) dayLessons[d] = [];
  }

  function liveRefreshAll(){
    try{ window.__refreshTimetableFromSettings && window.__refreshTimetableFromSettings(); }catch(e){}
    try{ renderAllPages && renderAllPages(); }catch(e){}
    try{ refreshDots && refreshDots(); }catch(e){}
    try{ refreshNotesDot && refreshNotesDot(); }catch(e){}
  }

  function persistAll(){
    saveJSON(KEY_HOURS, timeCfg);
    saveJSON(KEY_PAIRS, pairs);
    saveJSON(KEY_ACTIVE_DAYS, activeDays);
    saveJSON(KEY_DAYLESSONS, dayLessons);
  }

  // --- UI Init ---
  function initThemeAndFont(){
    const t = (localStorage.getItem(KEY_THEME) === "day") ? "day" : "night";
    applyTheme(t);

    const sz = localStorage.getItem(KEY_TEXTSIZE) || "medium";
    applyTextSize(sz);
  }

  function initTimeInputs(){
    const startInp = $("startTimeInp");
    const breakInp = $("breakInp");
    const lunchInp = $("lunchInp");
    const afterNoInp = $("afterNoInp");

    if(startInp) startInp.value = timeCfg.start || "08:15";
    if(breakInp) breakInp.value = Number(timeCfg.breakMin ?? 10);
    if(lunchInp) lunchInp.value = Number(timeCfg.lunchMin ?? 40);
    if(afterNoInp) afterNoInp.value = Number(timeCfg.afterNo ?? 5);

    const saveFromInputs = ()=>{
      timeCfg = {
        start: (startInp && startInp.value) ? startInp.value : "08:15",
        breakMin: Number(breakInp && breakInp.value !== "" ? breakInp.value : 10),
        lunchMin: Number(lunchInp && lunchInp.value !== "" ? lunchInp.value : 40),
        afterNo: Number(afterNoInp && afterNoInp.value !== "" ? afterNoInp.value : 5),
      };
      saveJSON(KEY_HOURS, timeCfg);
      // Değişiklikler anında ana sayfaya yansısın
      try{ liveRefreshAll(); }catch(e){}
    };

    // Zaman tablosu değişince Gün Programı saatlerini güncelle
    try{ renderPlanRows(); }catch(e){}

    [startInp, breakInp, lunchInp, afterNoInp].forEach(el=>{
      if(!el) return;
      el.addEventListener("change", saveFromInputs);
      el.addEventListener("input", saveFromInputs);
    });
  }

  function renderPairs(){
    const tbody = $("pairTbody");
    if(!tbody) return;
    tbody.innerHTML = "";
    pairs.forEach((p, idx)=>{
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${escapeHtml(p.cls||"")}</td>
        <td>${escapeHtml(p.lesson||"")}</td>
        <td style="text-align:right;">
          <button class="miniBtn pairDel" type="button" data-i="${idx}">Sil</button>
        </td>
      `;
      tbody.appendChild(tr);
    });
    tbody.querySelectorAll(".pairDel").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const i = Number(btn.getAttribute("data-i"));
        if(Number.isFinite(i)){
          pairs.splice(i,1);
          saveJSON(KEY_PAIRS, pairs);
          renderPairs();
        }
      });
    });
  }

  function initPairs(){
    const clsInp = $("clsInp");
    const lesInp = $("lesInp");
    const addBtn = $("btnAddPair");

    if(addBtn){
      addBtn.addEventListener("click", ()=>{
        const cls = (clsInp && clsInp.value || "").trim();
        const lesson = (lesInp && lesInp.value || "").trim();
        if(!cls && !lesson) return;
        pairs.push({cls, lesson});
        saveJSON(KEY_PAIRS, pairs);
        if(clsInp) clsInp.value = "";
        if(lesInp) lesInp.value = "";
        renderPairs();
      });
    }
    renderPairs();
  }

  function renderActiveDays(){
    const grid = $("activeDaysGrid");
    if(!grid) return;
    grid.innerHTML = "";
    DAYS.forEach((name, i)=>{
      const label = document.createElement("label");
      label.className = "dayOption";
      label.innerHTML = `
        <input class="dayChk" type="checkbox" data-i="${i}" ${activeDays[i] ? "checked":""}/>
        <span class="dayName">${name.toUpperCase()}</span>
      `;
      grid.appendChild(label);
    });

    grid.querySelectorAll(".dayChk").forEach(chk=>{
      chk.addEventListener("change", ()=>{
        const i = Number(chk.getAttribute("data-i"));
        if(!Number.isFinite(i)) return;
        activeDays[i] = !!chk.checked;
        saveJSON(KEY_ACTIVE_DAYS, activeDays);
      try{ liveRefreshAll(); }catch(e){}
        // Ayarlar kaydedildi; ana sayfa bu key'i okuyarak gün barını günceller.
        // (Gerekirse sayfayı yenileyince anında uygulanır.)
      });
    });
  }


  // Day plan editor
  let curDay = 0;

  function lessonCountForDay(d){
    const arr = Array.isArray(dayLessons[d]) ? dayLessons[d] : [];
    // en az mevcut uzunluk kadar göster, ama select ile azaltılabilir
    return Math.max(arr.length, 0);
  }

  function ensureDaySize(d, n){
    if(!Array.isArray(dayLessons[d])) dayLessons[d] = [];
    const arr = dayLessons[d];
    while(arr.length < n){
      arr.push({ no: arr.length+1, time:"", cls:"", lesson:"" });
    }
    if(arr.length > n){
      dayLessons[d] = arr.slice(0, n).map((x, idx)=>({ ...x, no: idx+1 }));
    }else{
      dayLessons[d] = arr.map((x, idx)=>({ ...x, no: idx+1 }));
    }
  }

  
  function uniqList(arr){
    const s = new Set();
    (arr||[]).forEach(v=>{
      const t = (v||"").trim();
      if(t) s.add(t);
    });
    return Array.from(s);
  }
  function getAllDayValues(key){
    // key: "cls" | "lesson"
    const out = [];
    try{
      Object.keys(dayLessons||{}).forEach(d=>{
        (dayLessons[d]||[]).forEach(it=>{
          if(it && it[key]) out.push(it[key]);
        });
      });
    }catch(e){}
    return out;
  }
  function getClassList(){
    // Öncelik: ayarlarda eklenen sınıf/ders çiftleri
    const fromPairs = (pairs||[]).map(p=>p && p.cls);
    // Ek güvence: mevcut programdaki sınıflar
    const fromPlan  = getAllDayValues("cls");
    return uniqList([...fromPairs, ...fromPlan]).sort((a,b)=>a.localeCompare(b,'tr'));
  }
  function getLessonList(){
    const fromPairs = (pairs||[]).map(p=>p && p.lesson);
    const fromPlan  = getAllDayValues("lesson");
    return uniqList([...fromPairs, ...fromPlan]).sort((a,b)=>a.localeCompare(b,'tr'));
  }
  function buildOptions(list, currentValue, placeholder){
    const cur = (currentValue||"").trim();
    const opts = [];
    opts.push(`<option value="">${escapeHtml(placeholder||"Seç")}</option>`);
    const set = new Set(list);
    if(cur && !set.has(cur)){
      opts.push(`<option value="${escapeAttr(cur)}" selected>${escapeHtml(cur)}</option>`);
    }
    list.forEach(v=>{
      const sel = (v===cur) ? ' selected' : '';
      opts.push(`<option value="${escapeAttr(v)}"${sel}>${escapeHtml(v)}</option>`);
    });
    return opts.join("");
  }

  function renderPlanRows(){
    const rowsWrap = $("planRows");
    const countSel = $("lessonCountSelect");
    const daySel = $("dayPlanSelect");
    if(!rowsWrap || !countSel || !daySel) return;

    curDay = Number(daySel.value) || 0;

    const desired = Number(countSel.value);
    const n = Number.isFinite(desired) ? desired : lessonCountForDay(curDay);

    ensureDaySize(curDay, n);
    saveJSON(KEY_DAYLESSONS, dayLessons);

    rowsWrap.innerHTML = "";
    const arr = dayLessons[curDay] || [];
    const slots = buildTimeSlots(arr.length);

    const clsList = getClassList();
    const lesList = getLessonList();

    for(let i=0; i<arr.length; i++){
      const it = arr[i] || {no:i+1,time:"",cls:"",lesson:""};
      const defaultTime = "";
      const t0 = (it.timeStart || (String(it.time||"").includes("-") ? String(it.time||"").split("-")[0] : (it.time||"")) || "");// varsayılan boş
const row = document.createElement("div");
      row.className = "planRow";
      const clsOpts  = buildOptions(clsList, it.cls, "Sınıf seç");
      const lesOpts  = buildOptions(lesList, it.lesson, "Ders seç");

      row.innerHTML = `
        <div class="planNo">${i+1}</div>
        <div>
          <input class="planInp timeInp" type="time" data-k="timeStart" data-i="${i}" value="${t0}">
        </div>
        <div>
          <select class="planInp leSel" data-k="cls" data-i="${i}">
            ${clsOpts}
          </select>
        </div>
        <div>
          <select class="planInp leSel" data-k="lesson" data-i="${i}">
            ${lesOpts}
          </select>
        </div>
      `;
      rowsWrap.appendChild(row);
    }

    rowsWrap.querySelectorAll(".planInp").forEach(el=>{
      el.addEventListener("change", ()=>{
        const i = Number(el.getAttribute("data-i"));
        const k = el.getAttribute("data-k");
        if(!Number.isFinite(i) || !k) return;
        ensureDaySize(curDay, n);
        const arr2 = dayLessons[curDay];

        // Saat girildiğinde: seçilen satırdan itibaren (öncekileri koru, sonrakileri tabloya göre YENİDEN yaz)
        if(k === "timeStart"){
          const v = (el.value || "").trim(); // "HH:MM"
          const arr = dayLessons[curDay] || [];
          if(v){
            try{
              const remain = Math.max(0, arr.length - i);
              const slots2 = buildTimeSlotsFromStart(v, remain);

              // seçilen satır ve SONRASINI tabloya göre yeniden yaz (override)
              for(let t=i; t<arr.length; t++){
                arr[t] = arr[t] || {};
                const rng = slots2[t - i] || "";
                arr[t].timeStart = rng ? rng.split("-")[0] : "";
                arr[t].time = rng;
              }

              dayLessons[curDay] = arr;
              saveJSON(KEY_DAYLESSONS, dayLessons);
              renderPlanRows();
              return;
            }catch(e){}
          }else{
            // bu satır boşaltıldıysa, sadece bu satır ve sonrasını temizle
            try{
              for(let t=i; t<arr.length; t++){
                arr[t] = arr[t] || {};
                arr[t].timeStart = "";
                arr[t].time = "";
              }
              dayLessons[curDay] = arr;
              saveJSON(KEY_DAYLESSONS, dayLessons);
              renderPlanRows();
              return;
            }catch(e){}
          }
        }
arr2[i][k] = (el.value || "").trim();
        saveJSON(KEY_DAYLESSONS, dayLessons);});
    });
  }


  function initPlanEditor(){
    const daySel = $("dayPlanSelect");
    const countSel = $("lessonCountSelect");
    if(!daySel || !countSel) return;
    if(planEditorInited){
      // Ayarlar tekrar açıldığında tabloyu tazele
      try{ renderPlanRows(); }catch(e){}
      return;
    }
    planEditorInited = true;

    // başlangıçta mevcut veri uzunluğunu seçime yansıt
    const syncCount = ()=>{
      const d = Number(daySel.value) || 0;
      const existing = Array.isArray(dayLessons[d]) ? dayLessons[d].length : 0;
      // Eğer kullanıcı 0'dan farklı bir değer seçtiyse ve henüz veri yoksa onu ezme
      if(existing === 0 && countSel.value && countSel.value !== "0") return;
      // seçenek aralığı 0..12
      const v = Math.min(12, Math.max(0, existing));
      countSel.value = String(v);
    };

    daySel.addEventListener("change", ()=>{
      syncCount();
      renderPlanRows();
    });
    countSel.addEventListener("change", renderPlanRows);

    syncCount();
    renderPlanRows();
  }

  // --- Helpers (XSS safe for table) ---
  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, c=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[c]));
  }
  function escapeAttr(s){
    // input value
    return escapeHtml(s).replace(/\n/g," ");
  }

  function hhmmToMin(hhmm){
    const m = String(hhmm||"").match(/^(\d{1,2}):(\d{2})$/);
    if(!m) return 8*60+15;
    const h = Math.min(23, Math.max(0, Number(m[1])));
    const mi = Math.min(59, Math.max(0, Number(m[2])));
    return h*60 + mi;
  }
  function minToHHMM(total){
    let m = Number(total)||0;
    m = ((m%1440)+1440)%1440;
    const h = Math.floor(m/60);
    const mi = m%60;
    return String(h).padStart(2,"0")+":"+String(mi).padStart(2,"0");
  }
  function buildTimeSlots(count){
    const n = Math.max(0, Number(count)||0);
    const start = hhmmToMin(timeCfg && timeCfg.start ? timeCfg.start : "08:15");
    const br = Number(timeCfg && timeCfg.breakMin!=null ? timeCfg.breakMin : 10);
    const lu = Number(timeCfg && timeCfg.lunchMin!=null ? timeCfg.lunchMin : 40);
    const afterNo = Math.max(1, Number(timeCfg && timeCfg.afterNo!=null ? timeCfg.afterNo : 5));
    let cur = start;
    const out = [];
    for(let i=1; i<=n; i++){
      const end = cur + LESSON_MIN;
      out.push(minToHHMM(cur)+"-"+minToHHMM(end));
      cur = end;
      if(i<n){
        cur += (i === (afterNo-1)) ? lu : br;
      }
    }
    return out;
  }


  // Serbest başlangıç saatinden (HH:MM) itibaren zaman tablosuna göre slot üretir
  function buildTimeSlotsFromStart(startHHMM, count){
    const n = Math.max(0, Number(count)||0);
    if(!startHHMM) return Array(n).fill("");
    const start = hhmmToMin(startHHMM);
    const br = Number(timeCfg && timeCfg.breakMin!=null ? timeCfg.breakMin : 10);
    const lu = Number(timeCfg && timeCfg.lunchMin!=null ? timeCfg.lunchMin : 40);
    const afterNo = Math.max(1, Number(timeCfg && timeCfg.afterNo!=null ? timeCfg.afterNo : 5));
    let cur = start;
    const out = [];
    for(let i=1; i<=n; i++){
      const end = cur + LESSON_MIN;
      out.push(minToHHMM(cur)+"-"+minToHHMM(end));
      cur = end;
      if(i<n){
        cur += (i === (afterNo-1)) ? lu : br;
      }
    }
    return out;
  }


  // --- Wiring ---
  function bindButtons(){
    const btnOpen = $("btnSettings");
    if(btnOpen) btnOpen.addEventListener("click", openSettings);

    const backdrop = document.getElementById("settingsBackdrop");
    if(backdrop) backdrop.addEventListener("click", closeSettings);

    const btnClose = $("btnCloseSettings");
    if(btnClose) btnClose.addEventListener("click", closeSettings);

    const btnSaveTop = $("btnSaveSettingsTop");
    if(btnSaveTop) btnSaveTop.addEventListener("click", ()=>{
      try{ persistAll && persistAll(); }catch(e){}
      try{ liveRefreshAll && liveRefreshAll(); }catch(e){}
      try{ window.showToast && window.showToast("Kaydedildi"); }catch(e){}
      // Kaydet sadece kayıt yapsın (kapatmasın)
});
const btnDay = $("btnDay");
    const btnNight = $("btnNight");
    if(btnDay) btnDay.addEventListener("click", ()=>applyTheme("day"));
    if(btnNight) btnNight.addEventListener("click", ()=>applyTheme("night"));

    const fontSel = $("fontSizeSelect");
    if(fontSel) fontSel.addEventListener("change", ()=>applyTextSize(fontSel.value));
  }

  // init on DOM ready (after main app scripts)
  function init(){
    bindButtons();
    initThemeAndFont();
    initTimeInputs();
    initPairs();
    renderActiveDays();
    initPlanEditor();
  }

  if(document.readyState === "loading"){
    document.addEventListener("DOMContentLoaded", init);
  }else{
    init();
  }
})();

</script>

</body>
</html>
